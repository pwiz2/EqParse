<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>eqparse.xppautparser &mdash; src  documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="src  documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">src  documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for eqparse.xppautparser</h1><div class="highlight"><pre>
<span class="c">#! /usr/bin/env python</span>

<span class="kn">from</span> <span class="nn">baseparse</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Xppaut PARSER</span>
<span class="sd">&quot;&quot;&quot;</span>

<div class="viewcode-block" id="XppautParser"><a class="viewcode-back" href="../../eqparse.html#eqparse.xppautparser.XppautParser">[docs]</a><span class="k">class</span> <span class="nc">XppautParser</span> <span class="p">(</span><span class="n">BaseParse</span><span class="p">):</span>

	<span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Lib</span><span class="p">):</span>
		<span class="nb">super</span><span class="p">(</span><span class="n">XppautParser</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">l_enclose</span> <span class="o">=</span> <span class="s">&quot;()&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">r_enclose</span> <span class="o">=</span> <span class="s">&quot;)&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">operations</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">if(&#39;</span><span class="p">,</span> <span class="s">&quot;)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;else{</span><span class="se">\n\t</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;}</span><span class="se">\n</span><span class="s">else if{</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;}</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;!=&quot;</span><span class="p">,</span> <span class="s">&quot;((&quot;</span><span class="p">,</span> <span class="s">&quot;)^(&quot;</span><span class="p">,</span> <span class="s">&quot;))&quot;</span><span class="p">]</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">vec_counter_start</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">comment_prefix</span> <span class="o">=</span> <span class="s">&quot;# &quot;</span>		
		<span class="bp">self</span><span class="o">.</span><span class="n">fileExt</span> <span class="o">=</span> <span class="s">&quot;ode&quot;</span>
		
		<span class="bp">self</span><span class="o">.</span><span class="n">initialise_library</span> <span class="p">(</span><span class="n">Lib</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">temp_name</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">temp_filename</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
		
		<span class="c">#def set_directory(self, dir_str):</span>
		<span class="c">#	&quot;&quot;&quot; Overridden XPPAUT Set directory where file specific parser files are saved to, </span>
		<span class="c">#	the directory can be a relative path and not necessarily an absolute path</span>
		<span class="c">#	</span>
		<span class="c">#	:param dir_str: string of path to directory</span>
		<span class="c">#	&quot;&quot;&quot;</span>
		<span class="c">#	if isinstance(dir_str, str) is False: error(&quot;set_directory argument not a string&quot;)</span>
		<span class="c">#	elif not dir_str: pass</span>
		<span class="c">#	elif (os.path.isdir(dir_str)) is False: error(&quot;directory does not exist&quot;)</span>
		<span class="c">#	else: </span>
		<span class="c">#		self.directory = dir_str	</span>
	
<div class="viewcode-block" id="XppautParser.set_temp_ic_name"><a class="viewcode-back" href="../../eqparse.html#eqparse.xppautparser.XppautParser.set_temp_ic_name">[docs]</a>	<span class="k">def</span> <span class="nf">set_temp_ic_name</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
		<span class="c">#print &quot;dir:&quot; + self.directory</span>
		<span class="c">#print &quot;tit:&quot; + self.title </span>
		<span class="c">#.replace(&#39;/&#39;,&#39;_&#39;).replace(&#39;\\&#39;,&#39;_&#39;) + self.title.replace(&#39;/&#39;,&#39;_&#39;).replace(&#39;\\&#39;,&#39;_&#39;)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">temp_name</span> <span class="o">=</span> <span class="s">&quot;tdat_245345_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span><span class="s">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">,</span><span class="s">&#39;_&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span><span class="s">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">,</span><span class="s">&#39;_&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())[</span><span class="o">-</span><span class="mi">4</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">temp_filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_name</span> <span class="o">+</span> <span class="s">&quot;.py&quot;</span>
		
		<span class="c">#print self.directory</span>
		<span class="c">#print self.title</span>
		<span class="c">#print self.temp_name</span>
	    </div>
<div class="viewcode-block" id="XppautParser.xpp_search_and_define"><a class="viewcode-back" href="../../eqparse.html#eqparse.xppautparser.XppautParser.xpp_search_and_define">[docs]</a>	<span class="k">def</span> <span class="nf">xpp_search_and_define</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
		<span class="k">pass</span>
		</div>
<div class="viewcode-block" id="XppautParser.printarray"><a class="viewcode-back" href="../../eqparse.html#eqparse.xppautparser.XppautParser.printarray">[docs]</a>	<span class="k">def</span> <span class="nf">printarray</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">specific</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">specific</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;range&#39;</span><span class="p">]:</span>
				<span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">elem</span><span class="p">])</span>
			<span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">print</span> <span class="n">specific</span> <span class="o">+</span> <span class="s">&quot;: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">specific</span><span class="p">)])</span>			
</div>
<div class="viewcode-block" id="XppautParser.truncate_ics"><a class="viewcode-back" href="../../eqparse.html#eqparse.xppautparser.XppautParser.truncate_ics">[docs]</a>	<span class="k">def</span> <span class="nf">truncate_ics</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">set_temp_ic_name</span><span class="p">()</span>

		<span class="c">#print &quot;hello&quot;</span>
		<span class="n">absic_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_filename</span><span class="p">,</span><span class="s">&quot;w+&quot;</span><span class="p">)</span>
 		<span class="n">absic_file</span><span class="o">.</span><span class="n">truncate</span><span class="p">()</span>
 		
 		<span class="c">#self.PERM_I_LIST = [&#39;IF[[&#39;, &quot;]]:&quot;, &quot;ELSE:&quot;, &quot;ELIF:&quot;, &quot;END:&quot;, &quot;!=&quot;, &quot;POW[[&quot;, &quot;||&quot;, &quot;]]&quot;]	### put in self. vars, helper</span>

 		<span class="c">#o_ops =  [&quot;POW[[&quot;, &quot;||&quot;, &quot;]]&quot;,&quot;exp(&quot;,&quot;log(&quot;,&quot;log10(&quot;]</span>
 		<span class="c">#sub_ops = [&quot;(&quot;, &quot;)**(&quot;, &quot;)&quot;,&quot;math.exp(&quot;,&quot;math.log(&quot;,&quot;math.log10(&quot;]</span>
 		<span class="n">o_ops</span> <span class="o">=</span>  <span class="p">[</span><span class="s">&quot;)^(&quot;</span><span class="p">,</span><span class="s">&quot;exp(&quot;</span><span class="p">,</span><span class="s">&quot;log(&quot;</span><span class="p">,</span><span class="s">&quot;log10(&quot;</span><span class="p">]</span>
 		<span class="n">sub_ops</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;)**(&quot;</span><span class="p">,</span><span class="s">&quot;math.exp(&quot;</span><span class="p">,</span><span class="s">&quot;math.log(&quot;</span><span class="p">,</span><span class="s">&quot;math.log10(&quot;</span><span class="p">]</span>
 		<span class="n">repl_set</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">o_ops</span><span class="p">,</span><span class="n">sub_ops</span><span class="p">))</span>
 		<span class="n">abs_out</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="s">&#39;init-value&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">]</span>
 		<span class="n">mIndex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;range&#39;</span><span class="p">])</span>
 		<span class="c">#print mIndex</span>
 		<span class="n">absic_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;import math</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>
 		<span class="n">absic_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;def get_value():</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
 		
 		<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">repl_set</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
			<span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;range&#39;</span><span class="p">]:</span>
				<span class="n">abs_out</span><span class="p">[</span><span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="n">abs_out</span><span class="p">[</span><span class="n">it</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
		<span class="c">#print len(mIndex)</span>
		<span class="c">#JOJO=[]		</span>
 		<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">mIndex</span><span class="p">:</span>
 			<span class="c">#print self.names[elem]</span>
 			<span class="c">#JOJO.append(self.names[elem])</span>
 			<span class="n">absic_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39; = &#39;</span> <span class="o">+</span> <span class="n">abs_out</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
 			<span class="c">#absic_file.write(&#39;\tprint &quot;&#39; + self.names[elem] + &#39;&quot; + &quot;: &quot; + str(&#39; + self.names[elem] + &#39;)\n&#39;)</span>
		
		<span class="c">#print list(set(self.names)-set(JOJO))</span>
		<span class="c">#print set.(self.names).symmetric_difference(set(JOJO))</span>

		<span class="n">absic_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">return [&quot;</span><span class="p">)</span>
		<span class="c">#for elem in mIndex[:-2]:</span>
		<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;range&#39;</span><span class="p">]:</span>
 			<span class="n">absic_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span><span class="p">)</span>
 		<span class="n">absic_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
 			<span class="c">#print elem</span>
 		
		<span class="n">absic_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;]&quot;</span><span class="p">)</span>
 		<span class="n">absic_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


 		<span class="n">iModule</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_name</span><span class="p">)</span>
 		<span class="n">new_absic</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">iModule</span><span class="o">.</span><span class="n">get_value</span><span class="p">())</span>
 		<span class="c">#print len(self.names)		</span>
		<span class="c">#print len(new_absic)</span>
		<span class="c">#print list(set(self.names)-set(JOJO))</span>
		<span class="c">#print self.temp_name</span>
		</div>
<div class="viewcode-block" id="XppautParser.parse_one"><a class="viewcode-back" href="../../eqparse.html#eqparse.xppautparser.XppautParser.parse_one">[docs]</a>	<span class="k">def</span> <span class="nf">parse_one</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">concateq_unordered</span> <span class="o">=</span> <span class="p">[]):</span>
		
		<span class="c"># data vars</span>
		<span class="n">mfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>
		<span class="n">mcomment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_comment</span>
		<span class="n">mwrite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span>

		<span class="c"># open file</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">open_file</span> <span class="p">(</span><span class="n">mfile</span><span class="p">)</span>
		
		<span class="c"># A : gather the function related index</span>
		<span class="c">## note: j for i, is converting list-of-lists to list</span>
		<span class="c">#def get_list (self, mKey, mLib = None, mPrefix =&quot;&quot;, mPostfix =&quot;&quot;, mIndex = None):</span>
		<span class="c">#indexrhs = self.new_index(self.index[&#39;rhs&#39;][&#39;yes&#39;]) # get index of non ode rhs</span>
		<span class="c">#grhs = self.get_list (&quot;rhs&quot;, self.data, &quot;&quot;, &quot;&quot;, indexrhs)</span>
		<span class="c">#func_names = [j for i in [x[&#39;rhs&#39;] for x in self.info[&#39;function&#39;]] for j in i] # ORIGINAL</span>
		<span class="n">func_names</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;rhs&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">]]</span>
		<span class="c">#print func_names</span>
		<span class="c">#print len(func_names)</span>
		
		<span class="n">func_names</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">func_names</span><span class="p">]</span>
		<span class="n">func_names</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
 		<span class="n">is_func</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;yes&#39;</span><span class="p">:</span><span class="n">func_names</span><span class="p">,</span><span class="s">&#39;no&#39;</span><span class="p">:[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">))</span> <span class="k">if</span> <span class="n">r</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">func_names</span><span class="p">]}</span>
 		<span class="c">#print is_func</span>
 		<span class="c"># B : initial conditions get absolute numbers (need to run and create external file)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">truncate_ics</span><span class="p">()</span>
		<span class="c">#startFile = &quot;tdat_245345_&quot; + self.title + &quot;.py&quot;</span>
 		<span class="c">#import startFile as semiSolve</span>
 		<span class="n">iModule</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_name</span><span class="p">)</span>
 		<span class="k">try</span><span class="p">:</span>
			<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_filename</span><span class="p">)</span>
		<span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
			<span class="k">pass</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_filename</span><span class="o">+</span><span class="s">&quot;c&quot;</span><span class="p">)</span>		
		<span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
			<span class="k">pass</span>
 		<span class="n">new_absic</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">iModule</span><span class="o">.</span><span class="n">get_value</span><span class="p">())</span>
 		<span class="c">#print new_absic</span>
 		<span class="c">#for elem in mIndex:</span>
 		<span class="c">#	print self.names[elem] + &quot; + &quot; + str(new_absic[elem])</span>
 		<span class="c">##print self.directory</span>
 		<span class="c">##print self.title</span>
 		<span class="c">##print self.temp_name	</span>
		
		<span class="c"># C : gather new NAME and RHS for ode/funcs arguments</span>
		
		<span class="c"># order concateq_unordered according to self.order.init_value</span>
		<span class="n">concateq</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;order&#39;</span><span class="p">][</span><span class="s">&#39;init-value&#39;</span><span class="p">]:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="ow">in</span> <span class="n">concateq_unordered</span><span class="p">:</span>
				<span class="n">concateq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">elem</span><span class="p">])</span>
		<span class="c">#print concateq</span>
		
		<span class="n">concat_index</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">concateq</span><span class="p">]</span>
		<span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list</span><span class="p">(</span><span class="s">&#39;rhs&#39;</span><span class="p">)</span> <span class="c">#[x[&#39;rhs&#39;] for x in self.data]</span>
		<span class="c">#print a</span>
		<span class="c">#self.printarray(a,&quot;I_Natotm&quot;)</span>
		<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">concat_index</span><span class="p">:</span>
			<span class="n">a</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
			
 		<span class="n">concateq_rhs_sub</span> <span class="o">=</span> <span class="p">[]</span>
 		<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">concateq</span><span class="p">:</span>
 			<span class="n">concateq_rhs_sub</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;(&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">elem</span><span class="p">)][</span><span class="s">&#39;rhs&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span><span class="p">)</span>
		<span class="c">#print concateq</span>
		<span class="c">#print concateq[concateq.index(&quot;I_NaKCl_Na&quot;)]</span>
		<span class="c">#print concateq_rhs_sub[concateq.index(&quot;I_NaKCl_Na&quot;)]</span>

		<span class="c">#concateq_rhs_sub = [&#39;&#39;.join(line) for line in [ [concateq_rhs_sub[concateq.index(word)] if word in concateq else word for word in mline] for mline in [re.split(&#39;(\W)&#39;,line) for line in concateq_rhs_sub]]]</span>
		<span class="c">#print concateq_rhs_sub[concateq.index(&quot;I_NaKCl_Na&quot;)]</span>
		
		<span class="c">#import time</span>
		<span class="c">#start = time.time()</span>

		<span class="c">#### alternative search and replace (slow but maintains changes)</span>
		<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">concateq_rhs_sub</span><span class="p">)):</span>	
			<span class="n">line</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;(\W)&#39;</span><span class="p">,</span><span class="n">concateq_rhs_sub</span><span class="p">[</span><span class="n">elem</span><span class="p">])</span>
			<span class="c">#print &#39;line: &#39; + str(line)</span>
			<span class="k">for</span> <span class="n">word_pos</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)):</span>
				 <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="n">word_pos</span><span class="p">]</span> <span class="o">==</span> <span class="n">concateq</span><span class="p">[</span><span class="n">elem</span><span class="p">]:</span>
				 	<span class="k">pass</span>
				 <span class="k">elif</span> <span class="n">line</span><span class="p">[</span><span class="n">word_pos</span><span class="p">]</span> <span class="ow">in</span> <span class="n">concateq</span><span class="p">:</span>
				 	<span class="c">#print &#39;:::::&#39; + line[word_pos] + &#39; : &#39; + concateq_rhs_sub[concateq.index(line[word_pos])]</span>
				 	<span class="n">line</span><span class="p">[</span><span class="n">word_pos</span><span class="p">]</span> <span class="o">=</span> <span class="n">concateq_rhs_sub</span><span class="p">[</span><span class="n">concateq</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">word_pos</span><span class="p">])]</span>
				 	<span class="c">#print &#39;&gt;&gt;&gt;&gt;&#39; + line[word_pos]</span>
			<span class="n">concateq_rhs_sub</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
			

		<span class="c">#concateq_rhs_sub = [&#39;&#39;.join(line) for line in [ [self.data[self.names.index(word)][&#39;rhs&#39;] if word in concateq else word for word in mline] for mline in [re.split(&#39;(\W)&#39;,line) for line in concateq_rhs_sub]]]</span>
		<span class="c">##print self.data[self.names.index(&quot;I_NaKCl_Cl&quot;)][&#39;rhs&#39;]</span>
		<span class="c">#self.printarray(a,&quot;I_Natotm&quot;)</span>
		<span class="c">#print concateq_rhs_sub[concateq.index(&quot;I_NaKCl_Na&quot;)]</span>
		
		<span class="sd">&quot;&quot;&quot;get rhs of ODE: if argument was supplied, the ODE&quot;&quot;&quot;</span>
		<span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="p">[[</span><span class="n">concateq_rhs_sub</span><span class="p">[</span><span class="n">concateq</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">word</span><span class="p">)]</span> <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">concateq</span> <span class="k">else</span> <span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">mline</span><span class="p">]</span> <span class="k">for</span> <span class="n">mline</span> <span class="ow">in</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;(\W)&#39;</span><span class="p">,</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">a</span><span class="p">]]]</span>
		<span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;(\W)&#39;</span><span class="p">,</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">a</span><span class="p">]</span>
		<span class="c">#print a</span>
		<span class="c">#repl_set = dict(zip(concateq,concateq_rhs_sub))</span>
		<span class="c">#for key, val in repl_set.iteritems():	# replace concat equations embed into others</span>
		<span class="c">#	for it in self.info[&#39;range&#39;]:</span>
		<span class="c">#		a[it] = a[it].replace(key, val)</span>
				
		<span class="c">#ode_list = self.new_names (self.names, self.index[&#39;ode&#39;][&#39;no&#39;],[&quot;&quot;,&quot;&quot;],True)</span>
		<span class="sd">&quot;&quot;&quot; get each variable-dependent rhs and check for ode dependencies &quot;&quot;&quot;</span>
		<span class="n">ode_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_only_names</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">])</span>
		<span class="n">arg_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ode_list</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">elem</span><span class="p">))</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">a</span><span class="p">]</span>
		<span class="n">set_arg_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">set</span><span class="p">(</span><span class="n">ode_list</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">a</span><span class="p">]</span>

		<span class="c">#print arg_list</span>
		<span class="c">#print set_arg_list</span>
		<span class="c">#print arg_list[self.names.index(&quot;I_Na_NSCCb&quot;)]</span>
		
		<span class="sd">&quot;&quot;&quot; get all function variables which are dependent on ODE variables (at first glance) &quot;&quot;&quot;</span>
		<span class="n">names_ode_dep</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="nb">iter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arg_list</span><span class="p">)):</span>
			<span class="k">if</span> <span class="n">arg_list</span><span class="p">[</span><span class="nb">iter</span><span class="p">]:</span>
				<span class="n">names_ode_dep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="nb">iter</span><span class="p">])</span>
		<span class="c">#print names_ode_dep</span>

		<span class="sd">&quot;&quot;&quot; get all variables which are dependent on ode variables (indirect) &quot;&quot;&quot;</span>		
		<span class="n">arg_list_indirect</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">names_ode_dep</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">elem</span><span class="p">))</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">a</span><span class="p">]</span>
		<span class="c">#print arg_list_indirect	</span>
		<span class="c">#self.printarray(arg_list_indirect,&quot;I_Na_leak&quot;)</span>
		<span class="c">#self.printarray(arg_list,&quot;I_Na_leak&quot;)</span>
		
		<span class="n">arg_list_indirect</span> <span class="o">=</span> <span class="p">[[</span><span class="n">arg_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">elem</span><span class="p">)]</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">row</span><span class="p">]</span> <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">arg_list_indirect</span><span class="p">]</span>
		<span class="c">#print arg_list_indirect</span>
		
		<span class="c">#self.printarray(arg_list_indirect,&quot;I_Na_leak&quot;)</span>
		<span class="c">#print arg_list_indirect</span>
		
		<span class="n">arg_list_indirect</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">row</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]))</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">arg_list_indirect</span><span class="p">]</span>
		<span class="c">#self.printarray(arg_list_indirect,&quot;I_Na_leak&quot;)</span>
		<span class="c">#self.printarray(arg_list,&quot;I_Na_leak&quot;)</span>

		
		<span class="n">arg_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">arg_list</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">+</span> <span class="n">arg_list_indirect</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;range&#39;</span><span class="p">]</span> <span class="p">]</span>
		<span class="n">arg_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">row</span><span class="p">))</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">arg_list</span><span class="p">]</span>
		
		<span class="c">#print &quot;\n&quot;</span>
		<span class="c">#print arg_list </span>
		<span class="c">#print arg_list_indirect[self.names.index(&quot;I_BKCa&quot;)]</span>
		
		<span class="c">#print arg_list_indirect[self.names.index(&quot;I_BKCa&quot;)]</span>

		<span class="c"># check if other ode dep index is a part of it</span>
		<span class="c">#index_ode_dep = [self.info[&#39;range&#39;][arg_list.index(x)] for x in arg_list if x]</span>
		<span class="c">#names_ode_dep = [self.names[elem] for elem in index_ode_dep]</span>
		<span class="c">#names_ode_dep = [self.info[&#39;range&#39;][arg_list.index(x)] for x in arg_list if x]</span>
		<span class="c">#names_ode_dep = []</span>
		<span class="c">#for iter in range(len(arg_list)):</span>
		<span class="c">#	if arg_list[iter]:</span>
		<span class="c">#		names_ode_dep.append(self.names[iter])</span>
		<span class="c">#rhs_arg_list = [list(set(names_ode_dep).intersection(elem)) for elem in a]</span>
		<span class="c">#print rhs_arg_list</span>

		

		<span class="c">#rhs_arg_list = [arg_list[self.names.index(row)] for row in [elem for elem in rhs_arg_list] if row]</span>
		<span class="c">#rhs_arg_list = [[arg_list[self.names.index(elem)] for elem in row] if row is not None else [] for row in rhs_arg_list]</span>
		<span class="c">#rhs_arg_list = [set([item for sublist in row for item in sublist]) for row in rhs_arg_list]</span>

		<span class="c">#for elem in rhs_arg_list</span>
		<span class="c">#print rhs_arg_list</span>
				
		
		
		<span class="n">arg_list</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">arg_list</span><span class="p">]</span>
		<span class="n">arg_list</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;(&#39;</span><span class="o">+</span><span class="n">elem</span><span class="o">+</span><span class="s">&#39;)&#39;</span> <span class="k">if</span> <span class="n">elem</span> <span class="k">else</span> <span class="n">elem</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">arg_list</span><span class="p">]</span>
		<span class="n">arg_names</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;range&#39;</span><span class="p">]:</span>
			<span class="k">if</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;no&#39;</span><span class="p">]:</span>
				<span class="n">arg_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span><span class="o">+</span><span class="n">arg_list</span><span class="p">[</span><span class="n">elem</span><span class="p">])</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">arg_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">elem</span><span class="p">])</span>
				
		<span class="c">#arg_rhs = self.search_and_replace ([x[&#39;rhs&#39;] for x in self.data], arg_names)</span>
		<span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">a</span><span class="p">]</span>
		<span class="n">arg_rhs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_and_replace</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">arg_names</span><span class="p">)</span>
		<span class="c">#print arg_names</span>
		<span class="c">#print arg_rhs</span>
		<span class="c">#for elem in range(len(self.names)):</span>
		<span class="c">#	print str(self.names[elem]) + &#39; = &#39; + str(arg_names[elem])</span>
		
		<span class="sd">&quot;&quot;&quot; ARG1 concatenate certain formulas into equation &quot;&quot;&quot;</span>
		<span class="c">#### alternative search and replace (slow but maintains changes)</span>
		<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arg_rhs</span><span class="p">)):</span>	
			<span class="n">line</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;(\W)&#39;</span><span class="p">,</span><span class="n">arg_rhs</span><span class="p">[</span><span class="n">elem</span><span class="p">])</span>
			<span class="c">#print &#39;line: &#39; + str(line)</span>
			<span class="k">for</span> <span class="n">word_pos</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)):</span>
				 <span class="c">#if line[word_pos] == concateq[elem]:</span>
				 <span class="c">#	pass</span>
				 <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="n">word_pos</span><span class="p">]</span> <span class="ow">in</span> <span class="n">concateq</span><span class="p">:</span>
				 	<span class="c">#print &#39;:::::&#39; + line[word_pos] + &#39; : &#39; + concateq_rhs_sub[concateq.index(line[word_pos])]</span>
				 	<span class="n">line</span><span class="p">[</span><span class="n">word_pos</span><span class="p">]</span> <span class="o">=</span> <span class="n">concateq_rhs_sub</span><span class="p">[</span><span class="n">concateq</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">word_pos</span><span class="p">])]</span>
				 	<span class="c">#print &#39;&gt;&gt;&gt;&gt;&#39; + line[word_pos]</span>
			<span class="n">arg_rhs</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
			
		
		<span class="c">#self.printarray(a,&quot;I_Na_leak&quot;)</span>
		<span class="c">#self.printarray(arg_list,&quot;I_Na_leak&quot;)</span>
		<span class="c">#self.printarray(arg_names,&quot;I_Na_leak&quot;)</span>
		<span class="c">#print self.temp_filename</span>
		<span class="c">#print arg_list</span>
		<span class="c">#print arg_names</span>
		
		<span class="c">#print &quot;part 1:  %.2f&quot; % (time.time()-start), &#39; seconds.&#39;</span>
	
		
		<span class="c">#start = time.time()</span>
		
		<span class="c">################### NEW CHANGE DEPENDENCIES</span>

		<span class="c">#a = [re.split(&#39;(\W)&#39;,line) for line in a]</span>
		<span class="c">#a get_list(mKey, mLib=None, mPrefix=&#39;&#39;, mPostfix=&#39;&#39;, mIndex=None)[source]</span>
		
		<span class="c">#&quot;&quot;&quot; get index of rhs in function order &quot;&quot;&quot;</span>
		<span class="c">#narg_index = []</span>
		<span class="c">#for i in range(len(self.info[&#39;function&#39;])):</span>
		<span class="c">#	narg_index = narg_index + self.info[&#39;function&#39;][i][&#39;index&#39;]</span>
		<span class="c">#</span>
		<span class="c">#&quot;&quot;&quot; get rhs (narg_rhs) and original names (narg_names) for the index of function order (narg_index)</span>
		<span class="c">#in addition get the ode names list (narg_ode_names)&quot;&quot;&quot;	</span>
		<span class="c">#narg_rhs = self.get_list(&#39;rhs&#39;,self.data,&#39;&#39;,&#39;&#39;,narg_index)</span>
		<span class="c">#narg_names = self.get_only_names(self.names, narg_index)</span>
<span class="c">#</span>
<span class="c">#		</span>
		<span class="c">#narg_ode_names = self.get_only_names(self.names, self.index[&#39;ode&#39;][&#39;yes&#39;])</span>
		<span class="c">#narg_ode_rhs = self.get_list(&#39;rhs&#39;,self.data,&#39;&#39;,&#39;&#39;,self.index[&#39;ode&#39;][&#39;yes&#39;]) # none function order	</span>
<span class="c">#</span>
		<span class="c">#narg_nonode_names = self.get_only_names(self.names, self.new_index(self.index[&#39;ode&#39;][&#39;no&#39;],self.index[&#39;rhs&#39;][&#39;yes&#39;]))				</span>
		<span class="c">#narg_nonode_rhs = self.get_list(&#39;rhs&#39;,self.data,&#39;&#39;,&#39;&#39;,self.new_index(self.index[&#39;ode&#39;][&#39;no&#39;],self.index[&#39;rhs&#39;][&#39;yes&#39;])) # none function order</span>
		<span class="c">#</span>
<span class="c">#</span>
		<span class="c">#</span>
		<span class="c">#&quot;&quot;&quot; get index dependecy order for non-ode functions &quot;&quot;&quot;		&quot;&quot;&quot;    &quot;&quot;&quot;</span>
		<span class="c">#index_nonode = self.new_dependancy_index(narg_nonode_rhs, self.get_only_names(self.names, self.new_index(self.index[&#39;ode&#39;][&#39;no&#39;],self.index[&#39;rhs&#39;][&#39;yes&#39;])))</span>
		<span class="c">#index_nonode = self.new_dependancy_index(self.new_index(self.index[&#39;ode&#39;][&#39;no&#39;],self.index[&#39;rhs&#39;][&#39;yes&#39;]),&#39;rhs&#39;)</span>
<span class="c">#</span>
		<span class="c">#</span>
		<span class="c">#&quot;&quot;&quot; set new order for non-ode as names and rhs &quot;&quot;&quot;</span>
		<span class="c">#narg_nonode_rhs = [narg_nonode_rhs[elem] for elem in index_nonode]</span>
		<span class="c">#narg_nonode_names = [narg_nonode_names[elem] for elem in index_nonode]</span>

		<span class="c">#&quot;&quot;&quot; split version of RHS to compare vaiables&quot;&quot;&quot;</span>
		<span class="c">#rhs_split = [re.split(&#39;(\W)&#39;,line) for line in narg_nonode_rhs]</span>
		<span class="c">#rhs_split_ode = [re.split(&#39;(\W)&#39;,line) for line in narg_ode_rhs]</span>
<span class="c">#</span>
		<span class="c">#		</span>
		<span class="c">#&quot;&quot;&quot; get if each has any ode dependence (direct) &quot;&quot;&quot;</span>
		<span class="c">#DVAR = [set(narg_ode_names).intersection(elem) for elem in rhs_split] </span>
<span class="c">#</span>
		<span class="c">#&quot;&quot;&quot; Check which functions are dependent on each other (by iter value) &quot;&quot;&quot;</span>
		<span class="c">#&quot;&quot;&quot; compare values and return index: find a better way, prob need to use itertools (?) &quot;&quot;&quot;</span>
		<span class="c">#indices = []</span>
		<span class="c">#names_dict = dict((k,i) for i,k in enumerate(narg_nonode_names)) # dict for iter</span>
		<span class="c">#for line in rhs_split:</span>
		<span class="c">#	#print names_dict.values()</span>
		<span class="c">#	dn = set(names_dict.keys()).intersection(line) # dn = dependent names</span>
		<span class="c">#	indices.append([names_dict[elem] for elem in dn])</span>
		<span class="c">#</span>
		<span class="c">#&quot;&quot;&quot;combine each dependency with [can be written in list comprehension]&quot;&quot;&quot;</span>
		<span class="c">#for it in range(0,len(indices)):</span>
		<span class="c">#	for collec in indices[it]:</span>
		<span class="c">#		DVAR[it] = set(DVAR[collec]).union(DVAR[it])</span>
<span class="c">##</span>
		<span class="c">#&quot;&quot;&quot; Do the same for each ODE, by finding out which of the ODEs ar dependent on each other&quot;&quot;&quot;</span>
		<span class="c">#rhs_split_ode = [re.split(&#39;(\W)&#39;,line) for line in narg_ode_rhs]</span>
		<span class="c">#for it in range(0,len(narg_ode_names)):</span>
		<span class="c">#	func_dep_odes = set(narg_names).intersection(rhs_split_ode[it])</span>
		<span class="c">#	#narg_names.in</span>
		<span class="c">#		</span>
		<span class="c">#&quot;&quot;&quot;organise new names depending on variable (replace function with argument)&quot;&quot;&quot;</span>
		<span class="c">#narg_nonode_names_replaced = []</span>
		<span class="c">#DVAR = [&#39;(&#39;+&#39;,&#39;.join(s)+&#39;)&#39; if s else &#39;&#39; for s in list(DVAR)]</span>
		<span class="c">#for it in range(0,len(DVAR)):</span>
		<span class="c">#	narg_nonode_names_replaced.append(narg_nonode_names[it] + DVAR[it])</span>
		<span class="c">#</span>
		<span class="c">#&quot;&quot;&quot; Now replace rhs with new names (need better performing one)&quot;&quot;&quot; </span>
		<span class="c">#for line_iter in range(0,len(rhs_split)):</span>
		<span class="c">#	for word_iter in range(0,len(rhs_split[line_iter])):</span>
		<span class="c">#		for wname_iter in range(0,len(narg_nonode_names)):</span>
		<span class="c">#			if rhs_split[line_iter][word_iter] == narg_nonode_names[wname_iter]:</span>
		<span class="c">#				rhs_split[line_iter][word_iter] = narg_nonode_names_replaced[wname_iter]</span>
		<span class="c">#names_nonode_rhs = [&#39;&#39;.join(line) for line in rhs_split]</span>
		<span class="c">#</span>
		<span class="c">#for line_iter in range(0,len(rhs_split_ode)):</span>
		<span class="c">#	for word_iter in range(0,len(rhs_split_ode[line_iter])):</span>
		<span class="c">#		for wname_iter in range(0,len(narg_nonode_names)):</span>
		<span class="c">#			if rhs_split_ode[line_iter][word_iter] == narg_nonode_names[wname_iter]:</span>
		<span class="c">#				rhs_split_ode[line_iter][word_iter] = narg_nonode_names_replaced[wname_iter]</span>
		<span class="c">#names_ode_rhs = [&#39;&#39;.join(line) for line in rhs_split_ode]</span>
		<span class="c">#print names_ode_rhs</span>


		<span class="c">#print &quot;part 2:  %.2f&quot; % (time.time()-start), &#39; seconds.&#39;</span>
		
		<span class="c">#narg_nonode_names = [narg_nonode_names[iter] + DVAR[iter] for iter in range(0,len(narg_nonode_names))]</span>
		
		<span class="c">#for i in range(0,len(narg_index)):</span>
		<span class="c">#	print str(narg_index[i]) + &quot; : &quot; + str(narg_names[i]) + &quot; = &quot; + str(narg_rhs[i])</span>
		<span class="c">#print index_nonode</span>
		<span class="c">#for i in range(0,len(narg_nonode_names)):</span>
		<span class="c">#	print str(i) + &quot; : &quot; + str(narg_nonode_names[i]) + &quot; = &quot; + str(names_nonode_rhs[i])</span>
		<span class="c">#for i in range(0,len(narg_nonode_names)):</span>
		<span class="c">#	print str(narg_nonode_names[i]) + &quot; = &quot; + str(DVAR[i])</span>
		<span class="c">#print DVAR</span>
		<span class="c">################### END OF CHANGE DEPENDENCIES</span>
		
		
		
		
		
		<span class="c">########  HEADER</span>
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfile</span><span class="p">,</span> <span class="s">&quot;XPPaut ode file for &quot;</span> <span class="o">+</span> <span class="n">mfile</span><span class="p">)</span>
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfile</span><span class="p">,</span> <span class="s">&quot;H. Arshad 2013</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
		<span class="n">nnn</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;0&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">arg_rhs</span><span class="p">)</span>
	
		<span class="c"># INITIAL CONDITIONS OF SYSTEM OF ODES	</span>
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfile</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;#&quot;</span><span class="p">,</span><span class="s">&quot;# Initial conditions&quot;</span><span class="p">,</span><span class="s">&quot;#&quot;</span><span class="p">],</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>
		<span class="c">#mIndex =  self.order_index(self.index[&#39;ode&#39;][&#39;yes&#39;])</span>
		<span class="n">mIndex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">])</span>
		<span class="c">#print &quot;HELLO::&quot; + str(len(new_absic))</span>
		<span class="c">#print &quot;HELLO::&quot; + str(len(mIndex))</span>
		<span class="c">#print mIndex</span>
		<span class="c">#print self.title</span>
		<span class="c">#print &quot;new_absic size :&quot; + str(len(new_absic))</span>
		<span class="c">#print &quot;self.names size :&quot; + str(len(self.names))</span>
		<span class="c">#print self.temp_filename</span>
		<span class="c">#print len(new_absic)</span>
		<span class="c">#print len(self.names)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">pattern_write</span> <span class="p">(</span><span class="n">mfile</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="n">new_absic</span><span class="p">],</span> <span class="p">[</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;(0)=&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">mIndex</span><span class="p">)</span>

		<span class="c"># DEFINE PARAMS</span>
		<span class="c">#print self.info[&#39;function&#39;]</span>
		<span class="c">#print self.index[&#39;ode&#39;][&#39;yes&#39;]</span>
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfile</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;#&quot;</span><span class="p">,</span><span class="s">&quot;# Define parameter values&quot;</span><span class="p">,</span><span class="s">&quot;#&quot;</span><span class="p">],</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>
		<span class="n">mIndex</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">order_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;no&#39;</span><span class="p">],</span><span class="n">is_func</span><span class="p">[</span><span class="s">&#39;no&#39;</span><span class="p">])</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">pattern_write</span> <span class="p">(</span><span class="n">mfile</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="n">new_absic</span><span class="p">],</span> <span class="p">[</span> <span class="s">&quot;param &quot;</span><span class="p">,</span> <span class="s">&quot;=&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">mIndex</span><span class="p">)</span>
	
		<span class="c"># DEFINE THE FUNCTIONS IN MODEL	</span>
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfile</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;#&quot;</span><span class="p">,</span><span class="s">&quot;# Functions used in the model&quot;</span><span class="p">,</span><span class="s">&quot;#&quot;</span><span class="p">],</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>
		<span class="c">#print set(self.info[&#39;range&#39;]).difference(concat_index)</span>
		<span class="n">mIndex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;no&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">new_index</span><span class="p">(</span><span class="n">is_func</span><span class="p">[</span><span class="s">&#39;yes&#39;</span><span class="p">],</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;range&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">concat_index</span><span class="p">))))</span>
		<span class="c">#concat_index = sorted(concat_index,reverse=True)</span>
		<span class="c">#print concat_index</span>
		<span class="c">#for elem in sorted(concat_index,reverse=True):</span>
		<span class="c">#	mIndex.pop(elem)</span>
		<span class="c">#print mIndex</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">pattern_write</span> <span class="p">(</span><span class="n">mfile</span><span class="p">,</span> <span class="p">[</span><span class="n">arg_names</span><span class="p">,</span> <span class="n">arg_rhs</span><span class="p">],</span> <span class="p">[</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;=&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">mIndex</span><span class="p">)</span>
		<span class="c">#self.pattern_write (mfile, [arg_names, nnn], [ &quot;&quot;, &quot;=&quot;, &quot;&quot;], self.data, mIndex)</span>
			
		<span class="c"># ODE DECLARATIONS (differential equations</span>
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfile</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;#&quot;</span><span class="p">,</span><span class="s">&quot;# ODE declarations/differential equations&quot;</span><span class="p">,</span><span class="s">&quot;#&quot;</span><span class="p">],</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>	
		<span class="n">mIndex</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">order_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">])</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">pattern_write</span> <span class="p">(</span><span class="n">mfile</span><span class="p">,</span> <span class="p">[</span><span class="n">arg_names</span><span class="p">,</span> <span class="n">arg_rhs</span><span class="p">],</span> <span class="p">[</span> <span class="s">&quot;d&quot;</span><span class="p">,</span> <span class="s">&quot;/dt = &quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">mIndex</span><span class="p">)</span>
		<span class="c">#self.pattern_write (mfile, [arg_names, nnn], [ &quot;d&quot;, &quot;/dt = &quot;, &quot;&quot;], self.data, mIndex)</span>

		
		<span class="c"># define properties of XPPaut system</span>
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfile</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;@ total=200000,dt=50,method=stiff,xlo=0,xhi=180000,ylo=0,yhi=0.001,bounds=1000,nout=1,maxstor=50000,bell=0,back=White&quot;</span><span class="p">,</span>
<span class="s">&quot;@autovar=c,ntst=150,nmax=400,npr=100,dsmin=0.000001,dsmax=0.5,ds=0.01,parmin=0,parmax=50,epsu=0.000001,epss=0.000001&quot;</span><span class="p">,</span>
<span class="s">&quot;@ autoxmin=0,autoxmax=10,autoymin=0,autoymax=1&quot;</span><span class="p">],</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>

		<span class="c"># footer and close file</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfile</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">done&quot;</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">close_file</span> <span class="p">(</span><span class="n">mfile</span><span class="p">)</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">src  documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Author.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>
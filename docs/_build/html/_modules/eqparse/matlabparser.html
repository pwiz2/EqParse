<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>eqparse.matlabparser &mdash; src  documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="src  documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">src  documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for eqparse.matlabparser</h1><div class="highlight"><pre>
<span class="c">#! /usr/bin/env python</span>

<span class="kn">from</span> <span class="nn">baseparse</span> <span class="kn">import</span> <span class="o">*</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">MATLAB PARSER</span>
<span class="sd">&quot;&quot;&quot;</span>

<div class="viewcode-block" id="MatlabParser"><a class="viewcode-back" href="../../eqparse.html#eqparse.matlabparser.MatlabParser">[docs]</a><span class="k">class</span> <span class="nc">MatlabParser</span> <span class="p">(</span><span class="n">BaseParse</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	To create matlab parsed file</span>
<span class="sd">	&quot;&quot;&quot;</span>
	
	<span class="c">#__metaclass__ = ReadOnlyClass</span>


	<span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Lib</span><span class="p">):</span>
		<span class="nb">super</span><span class="p">(</span><span class="n">MatlabParser</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">l_enclose</span> <span class="o">=</span> <span class="s">&quot;(&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">r_enclose</span> <span class="o">=</span> <span class="s">&quot;)&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">operations</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">if(&#39;</span><span class="p">,</span> <span class="s">&quot;)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;else</span><span class="se">\n\t</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;elif</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;end</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;~=&quot;</span><span class="p">,</span> <span class="s">&quot;(&quot;</span><span class="p">,</span> <span class="s">&quot;).^(&quot;</span><span class="p">,</span> <span class="s">&quot;)&quot;</span><span class="p">]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">vec_counter_start</span> <span class="o">=</span> <span class="mi">1</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">comment_prefix</span> <span class="o">=</span> <span class="s">&quot;%&quot;</span>		
		<span class="bp">self</span><span class="o">.</span><span class="n">fileExt</span> <span class="o">=</span> <span class="s">&quot;m&quot;</span>		
		
		<span class="bp">self</span><span class="o">.</span><span class="n">initialise_library</span> <span class="p">(</span><span class="n">Lib</span><span class="p">)</span>
		<span class="c"># set title as folder name in matlab directory,...</span>
		<span class="c"># ... and create if not exist</span>
		<span class="c">#s_direct = self.directory + &quot;/&quot; + self.title;</span>
		<span class="c">#if not os.path.exists (s_direct):</span>
		<span class="c">#	print &quot;::::::::::::wtf&quot; + s_direct</span>
		<span class="c">#	os.makedirs (s_direct)</span>
		<span class="c">#else:</span>
		<span class="c">#	print &quot;WARNING: over writing folder &quot; + self.title</span>
		<span class="c">#pass</span>
	
	
		
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	CREATE SINGLE-FILE MATLAB FILE FUNCTION</span>
<span class="sd">	&quot;&quot;&quot;</span>
<div class="viewcode-block" id="MatlabParser.solve_single"><a class="viewcode-back" href="../../eqparse.html#eqparse.matlabparser.MatlabParser.solve_single">[docs]</a>	<span class="k">def</span> <span class="nf">solve_single</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;generate single MATLAB (single_generic.m) file to solve equations. Runs the Euler finite differece scheme to model with  dt=5 (ms)	</span>
<span class="sd">		&quot;&quot;&quot;</span>	
		
		<span class="c"># simplified variables</span>
		<span class="n">mfile</span> <span class="o">=</span> <span class="s">&quot;single_generic&quot;</span>
		<span class="n">mfio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="n">mfile</span>
		<span class="n">mcomment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_comment</span>
		<span class="n">mwrite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span>
		<span class="n">set_p</span> <span class="o">=</span> <span class="s">&quot;set_param&quot;</span>
		<span class="n">total_time</span> <span class="o">=</span> <span class="s">&quot;tot_secs&quot;</span>
		<span class="n">s_mat</span> <span class="o">=</span> <span class="s">&quot;e_a&quot;</span>					<span class="c"># storage matrix</span>
		<span class="n">mget_result</span> <span class="o">=</span> <span class="s">&quot;S&quot;</span>
		
		<span class="c"># open single file</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">open_file</span> <span class="p">(</span><span class="n">mfio</span><span class="p">)</span>
		
		<span class="c"># write header</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;function &quot;</span> <span class="o">+</span> <span class="n">mget_result</span> <span class="o">+</span> <span class="s">&quot; = &quot;</span> <span class="o">+</span> <span class="n">mfile</span> <span class="o">+</span> <span class="s">&quot; (&quot;</span> <span class="o">+</span> <span class="n">set_p</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">total_time</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span><span class="p">,</span> \
							<span class="s">&quot;close all&quot;</span><span class="p">],</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>
		
		<span class="c"># get_list only used for </span>
		<span class="c">#self.get_list (self, mKey, mLib = None, mPrefix =&quot;&quot;, mPostfix =&quot;&quot;, mIndex = None):</span>
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;gather arguments from list and define settings&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;dt = 5;&quot;</span><span class="p">,</span> <span class="s">&quot;t =0:dt:&quot;</span> <span class="o">+</span> <span class="n">total_time</span> <span class="o">+</span> <span class="s">&quot;*1000;&quot;</span> <span class="p">])</span>
		
		<span class="c"># X = set_param.X and init-values direct</span>
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;gather user defined variables&quot;</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">pattern_write</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="s">&quot;comment&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot; = &quot;</span> <span class="o">+</span> <span class="n">set_p</span> <span class="o">+</span><span class="s">&quot;.&quot;</span><span class="p">,</span> <span class="s">&quot;; % &quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">],</span>
									<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;userdef&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">])</span> <span class="c"># ode can&#39;t be user de	</span>
		<span class="n">mIndex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_index</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;userdef&#39;</span><span class="p">][</span><span class="s">&#39;no&#39;</span><span class="p">])</span>	
		<span class="bp">self</span><span class="o">.</span><span class="n">pattern_write</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="s">&quot;init-value&quot;</span><span class="p">,</span> <span class="s">&quot;comment&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot; = &quot;</span><span class="p">,</span> <span class="s">&quot;; % &quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">],</span>
									<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">mIndex</span><span class="p">)</span>	
		<span class="c">#rhs_iter = self.get_list (&quot;rhs&quot;, self.data, &quot;&quot;, &quot;&quot;, None)</span>
		<span class="c">#rhs_init = self.get_list (&quot;init-value&quot;, self.data, &quot;&quot;, &quot;&quot;, None)</span>
		<span class="c">#init_list = [rhs_iter[it] if it in self.index[&#39;ode&#39;][&#39;no&#39;] else rhs_init[it] for it in self.info[&#39;range&#39;]]</span>

		<span class="c"># allocate storage							</span>
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;allocate space for printed variables (including ODEs)&quot;</span><span class="p">,</span> <span class="s">&quot; </span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="n">s_mat</span> <span class="o">+</span> <span class="s">&quot; = zeros (1, size(t,2)-1);&quot;</span><span class="p">)</span>
		
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;First all the functions...&quot;</span><span class="p">,</span> <span class="s">&quot; </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
		<span class="n">mIndex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_index</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;no&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;print&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">])</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">pattern_write</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="s">&quot;name&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot; = [ &quot;</span><span class="p">,</span> <span class="s">&quot;, &quot;</span> <span class="o">+</span> <span class="n">s_mat</span> <span class="o">+</span> <span class="s">&quot;];&quot;</span><span class="p">],</span> 
									<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">mIndex</span><span class="p">)</span>
		
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;... then ODE storage&quot;</span><span class="p">,</span> <span class="s">&quot; </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
		<span class="n">mIndex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_index</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;print&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">])</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">pattern_write</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="s">&quot;name&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot; = [ &quot;</span><span class="p">,</span> <span class="s">&quot;, &quot;</span> <span class="o">+</span> <span class="n">s_mat</span> <span class="o">+</span> <span class="s">&quot;, 0];&quot;</span><span class="p">],</span> 
									<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">mIndex</span><span class="p">)</span>
		
		<span class="c"># perform iterated simple step</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;max_iter = size(t,2);&quot;</span><span class="p">,</span>
						<span class="s">&quot;for iter = 1:max_iter&quot;</span><span class="p">],</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>
							
		<span class="n">index_print_nonode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_index</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;no&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;print&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">])</span>
		<span class="n">lhs_names_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_names</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_names</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">,</span> <span class="n">index_print_nonode</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="s">&quot;(iter)&quot;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="s">&quot;(iter+1)&quot;</span><span class="p">])</span>		
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;function&#39;</span><span class="p">])):</span>
			<span class="n">f_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;function&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;index&#39;</span><span class="p">]</span>
			<span class="n">f_var_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;function&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;rhs&#39;</span><span class="p">]</span>
			<span class="n">lhs_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_only_names</span> <span class="p">(</span><span class="n">lhs_names_list</span><span class="p">,</span> <span class="n">f_index</span><span class="p">)</span>
			<span class="n">rhs_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_names</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;print&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="s">&quot;(iter)&quot;</span><span class="p">])</span>
			<span class="n">rhs_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list</span> <span class="p">(</span><span class="s">&quot;rhs&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">f_index</span><span class="p">)</span>
			<span class="n">rhs_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_and_replace</span> <span class="p">(</span><span class="n">rhs_list</span><span class="p">,</span> <span class="n">rhs_names</span> <span class="o">+</span> <span class="p">[</span><span class="s">&quot;t(iter)&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">+</span> <span class="p">[</span><span class="s">&quot;t&quot;</span><span class="p">],</span> <span class="bp">False</span><span class="p">)</span>	
			<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">f_var_name</span><span class="p">)):</span>
				<span class="k">if</span> <span class="n">f_index</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">]:</span>
					<span class="n">rhs_list</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">=</span> <span class="n">f_var_name</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;(iter) + ( &quot;</span> <span class="o">+</span> <span class="n">rhs_list</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;)*dt&quot;</span>
			<span class="c">#print rhs_list		</span>
			<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;function&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;comment&#39;</span><span class="p">],</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">pattern_write</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="n">lhs_name</span><span class="p">,</span><span class="n">rhs_list</span><span class="p">],</span> <span class="p">[</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot; = &quot;</span><span class="p">,</span> <span class="s">&quot;;&quot;</span><span class="p">])</span>
			<span class="c">#def pattern_change (self, mIndex , orig,  *argv):</span>
			
		<span class="c">## print rhs_list</span>
		<span class="c">#index_print_nonode = self.new_index (self.index[&#39;ode&#39;][&#39;no&#39;], self.index[&#39;print&#39;][&#39;yes&#39;])</span>
		<span class="c">#lhs_names = self.new_names(self.new_names(self.names, index_print_nonode, [&quot;&quot;,&quot;(iter)&quot;]), self.index[&#39;ode&#39;][&#39;yes&#39;], [&quot;&quot;,&quot;(iter+1)&quot;])</span>
		<span class="c">## print rhs_list</span>
		<span class="c">#rhs_names = self.new_names(self.names, self.index[&#39;print&#39;][&#39;yes&#39;], [&quot;&quot;,&quot;(iter)&quot;])</span>
		<span class="c">#rhs_list = self.get_list (&quot;rhs&quot;, self.data, &quot;&quot;, &quot;&quot;, None)</span>

		<span class="c">#rhs_list = self.search_and_replace (rhs_list, rhs_names + [&quot;t(iter)&quot;], self.names + [&quot;t&quot;], False)</span>
		<span class="c">#rhs_list = self.pattern_change (self.index[&#39;ode&#39;][&#39;yes&#39;], rhs_list, self.names , &quot;(iter) + ( &quot;, rhs_list ,&quot; )*dt&quot;) ### this only works for all elements</span>

		<span class="c">#self.pattern_write (mfio, [lhs_names,rhs_list], [&quot;&quot;, &quot; = &quot;, &quot;;&quot;],	self.data, self.index[&#39;rhs&#39;][&#39;yes&#39;])</span>
									
		<span class="c"># reshape ode and time storage - well defined		</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;end&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">pattern_write</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="s">&quot;name&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot; = &quot;</span><span class="p">,</span> <span class="s">&quot;(1:end-1);&quot;</span><span class="p">],</span> 
									<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">mIndex</span><span class="p">)</span>
										
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="n">mget_result</span> <span class="o">+</span> <span class="s">&quot;.(&#39;t&#39;) = t./1000; &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment_prefix</span> <span class="o">+</span> <span class="s">&quot; change to seconds&quot;</span><span class="p">)</span>
		<span class="n">mIndex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_index</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;print&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">])</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">pattern_write</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="s">&quot;name&quot;</span><span class="p">],</span> <span class="p">[</span> <span class="n">mget_result</span> <span class="o">+</span> <span class="s">&quot;.(&#39;&quot;</span><span class="p">,</span> <span class="s">&quot;&#39;) = &quot;</span><span class="p">,</span> <span class="s">&quot;;&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">mIndex</span><span class="p">)</span>
									
		<span class="c"># close single file</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">close_file</span> <span class="p">(</span><span class="n">mfio</span><span class="p">)</span>


</div>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	CREATE RUN-FILE MATLAB FILE FUNCTION</span>
<span class="sd">	contains the actual set-up and organisation of cell system</span>
<span class="sd">	in a structured order, is also main file</span>
<span class="sd">	&quot;&quot;&quot;</span>
<div class="viewcode-block" id="MatlabParser.multi_runfile"><a class="viewcode-back" href="../../eqparse.html#eqparse.matlabparser.MatlabParser.multi_runfile">[docs]</a>	<span class="k">def</span> <span class="nf">multi_runfile</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newSubDirectory</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> 
						<span class="n">file_ext</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> 
						<span class="n">no_guess</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> 
						<span class="n">yes_guess</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> 
						<span class="n">wr_modifiers</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Create run file (run.m) that uses the ode file created from running alongside with :py:mod:`multi_odefile` module. This format is currently set for MATLAB defined implicit ode function - ode15s. </span>
<span class="sd">		</span>
<span class="sd">		:param newSubDirectory:</span>
<span class="sd">		:param file_ext: </span>
<span class="sd">		:param no_guess: </span>
<span class="sd">		:param yes_guess: </span>
<span class="sd">		:param wr_modifiers:	</span>
<span class="sd">		&quot;&quot;&quot;</span>	
								
		<span class="c">#mfile = &quot;run&quot; + file_ext</span>
		<span class="n">mfile</span> <span class="o">=</span>  <span class="s">&quot;run&quot;</span> <span class="o">+</span> <span class="n">file_ext</span>
		<span class="n">mfio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="n">newSubDirectory</span> <span class="o">+</span> <span class="s">&quot;run&quot;</span> <span class="o">+</span> <span class="n">file_ext</span>
		<span class="n">mcomment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_comment</span>
		<span class="n">mwrite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span>
		<span class="n">m_print</span> <span class="o">=</span> <span class="s">&quot;p_store&quot;</span>	<span class="c"># VC_NAME_PRINT</span>
		<span class="n">m_noprint</span> <span class="o">=</span> <span class="s">&quot;p&quot;</span>	<span class="c"># VEC_NAME</span>
		<span class="n">m_ode</span> <span class="o">=</span> <span class="s">&quot;dydt&quot;</span>	<span class="c"># ode var ODE_NAME</span>
		<span class="n">m_out</span> <span class="o">=</span> <span class="s">&quot;out&quot;</span>
		<span class="n">m_otime</span><span class="o">=</span> <span class="s">&#39;out_time&#39;</span>
		<span class="n">t_end</span> <span class="o">=</span> <span class="s">&quot;t_end&quot;</span>
		<span class="n">set_p</span> <span class="o">=</span> <span class="s">&quot;set_params&quot;</span>
		<span class="n">ode_method</span> <span class="o">=</span> <span class="s">&quot;ode15s&quot;</span>
		<span class="n">m_ode_fname</span> <span class="o">=</span> <span class="s">&quot;ode&quot;</span>
					
		<span class="c"># open file</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">open_file</span> <span class="p">(</span><span class="n">mfio</span><span class="p">)</span>
		
		<span class="c"># define header</span>
		<span class="k">if</span> <span class="n">yes_guess</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">mp</span> <span class="o">=</span> <span class="n">m_out</span>
		<span class="k">else</span><span class="p">:</span> <span class="n">mp</span> <span class="o">=</span> <span class="s">&quot;b_out&quot;</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;function &quot;</span> <span class="o">+</span> <span class="n">mp</span> <span class="o">+</span> <span class="s">&quot; = &quot;</span> <span class="o">+</span> <span class="n">mfile</span> <span class="o">+</span> <span class="s">&quot; (&quot;</span> \
							<span class="o">+</span> <span class="n">set_p</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span> <span class="o">+</span> <span class="n">t_end</span> <span class="o">+</span> <span class="s">&quot;, b_in)&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>	
		
		
		<span class="c"># preallocate storage</span>
		<span class="n">mI_user_no_ode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;print&#39;</span><span class="p">][</span><span class="s">&#39;no&#39;</span><span class="p">]</span>
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;preallocate storage for data&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="n">m_noprint</span> <span class="o">+</span> <span class="s">&quot; = zeros(1,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mI_user_no_ode</span><span class="p">))</span> <span class="o">+</span> <span class="s">&quot;);&quot;</span><span class="p">,</span>
						<span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot; = zeros(1,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;print&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">]))</span> <span class="o">+</span> <span class="s">&quot;);&quot;</span><span class="p">,</span>
						<span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot; = zeros(1,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">]))</span> <span class="o">+</span><span class="s">&quot;);&quot;</span><span class="p">])</span>

		<span class="c"># if parameterizing it, create initial data from external function</span>
		<span class="c"># and define parameter initial values also</span>
		<span class="k">if</span> <span class="n">no_guess</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
			<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;Define sample data to fit model here ()&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;[tdata,ydata] = create_ic (t_end);&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">if nargin&lt;3&quot;</span><span class="p">)</span>
			<span class="n">mName</span> <span class="o">=</span> <span class="p">[</span><span class="n">elem</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">];</span> <span class="n">cntr</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">yes_guess</span><span class="p">:</span>
				<span class="n">mName</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;b(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cntr</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span>
				<span class="n">cntr</span> <span class="o">=</span> <span class="n">cntr</span> <span class="o">+</span> <span class="mi">1</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">pattern_write</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="n">mName</span><span class="p">,</span> <span class="s">&quot;init-value&quot;</span><span class="p">,</span> <span class="s">&quot;comment&quot;</span><span class="p">],</span> <span class="p">[</span> <span class="s">&quot; &quot;</span><span class="p">,</span> <span class="s">&quot; = &quot;</span><span class="p">,</span> <span class="s">&quot;; </span><span class="se">\t</span><span class="s">% &quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_vec</span><span class="p">,</span> <span class="n">yes_guess</span><span class="p">)</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;else</span><span class="se">\n\t</span><span class="s">b=b_in</span><span class="se">\n</span><span class="s">end&quot;</span><span class="p">)</span>
			
		<span class="c"># ..user defined args</span>
		
		<span class="c">##struct_vec_names = self.get_list (&quot;name&quot;, self.data_vec)</span>
		<span class="c">##t_end_vec = struct_vec_names[self.names.index(t_end)]</span>
		<span class="c">#struct_vec_names[index_tend] = t_end</span>
		<span class="n">struct_vec_names</span> <span class="o">=</span> <span class="s">&quot;name&quot;</span>
		
		<span class="n">struct_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_names</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;userdef&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">set_p</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">])</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">pattern_write</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="n">struct_vec_names</span><span class="p">,</span> <span class="n">struct_names</span><span class="p">,</span> <span class="s">&quot;comment&quot;</span><span class="p">],</span> <span class="p">[</span> <span class="s">&quot; &quot;</span><span class="p">,</span> <span class="s">&quot; = &quot;</span><span class="p">,</span> <span class="s">&quot;;% &quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_vec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;userdef&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">])</span>		
		<span class="c"># .. function dependent</span>
		<span class="n">mIndex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;userdef&#39;</span><span class="p">][</span><span class="s">&#39;no&#39;</span><span class="p">])</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">pattern_write</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="s">&quot;init-value&quot;</span><span class="p">,</span> <span class="s">&quot;comment&quot;</span><span class="p">],</span> <span class="p">[</span> <span class="s">&quot; &quot;</span><span class="p">,</span> <span class="s">&quot; = &quot;</span><span class="p">,</span> <span class="s">&quot;;% &quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_vec</span><span class="p">,</span> <span class="n">mIndex</span><span class="p">)</span>

		<span class="c"># predefine time, if no input given</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;if nargin&lt;2&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">t_end</span> <span class="o">+</span> <span class="s">&quot; = &quot;</span> <span class="o">+</span> <span class="n">set_p</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span> <span class="o">+</span> <span class="n">t_end</span> <span class="o">+</span> <span class="s">&quot;;&quot;</span><span class="p">,</span> <span class="s">&quot;end</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">])</span>

		<span class="c"># start ode</span>
		<span class="k">if</span> <span class="n">no_guess</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;options = odeset(&#39;InitialStep&#39;,0.02,&#39;MaxStep&#39;,25, &#39;RelTol&#39;, 1e-9, &#39;AbsTol&#39;, 1e-9);&quot;</span><span class="p">,</span>
							<span class="s">&quot;[t,&quot;</span> <span class="o">+</span> <span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot;] = &quot;</span> <span class="o">+</span> <span class="n">ode_method</span> <span class="o">+</span> <span class="s">&quot;(@(tt,y)&quot;</span> <span class="o">+</span> <span class="n">m_ode_fname</span> <span class="o">+</span> <span class="s">&quot;(tt,y,&quot;</span> 
									<span class="o">+</span> <span class="n">m_noprint</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot;),&quot;</span> <span class="o">+</span>
								<span class="s">&quot;[0,&quot;</span> <span class="o">+</span> <span class="n">t_end</span> <span class="o">+</span> <span class="s">&quot;*1000],&quot;</span> <span class="o">+</span> <span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot;,options);&quot;</span><span class="p">],</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>
			<span class="c"># output resultsinto a struct</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;[~,&quot;</span> <span class="o">+</span> <span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot; ] = &quot;</span> <span class="o">+</span> <span class="n">m_ode_fname</span> <span class="o">+</span> <span class="s">&quot;([],[],[],[]);&quot;</span><span class="p">,</span>
					<span class="s">&quot;[~, index_max_t_] = max(&quot;</span> <span class="o">+</span> <span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot;(:,end));&quot;</span><span class="p">,</span>
					<span class="c">#m_print + &quot; = &quot; + m_print + &quot;(1:index_max_t_+1,:);&quot;,</span>
					<span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot; = &quot;</span> <span class="o">+</span> <span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot;(1:index_max_t_,:);&quot;</span><span class="p">,</span>
					<span class="n">m_out</span> <span class="o">+</span> <span class="s">&quot;= struct;&quot;</span><span class="p">,</span>
					<span class="n">m_out</span> <span class="o">+</span> <span class="s">&quot;.ode = t./1000;&quot;</span><span class="p">,</span>	<span class="c">#struct;&quot;,</span>
					<span class="n">m_out</span> <span class="o">+</span> <span class="s">&quot;.var = &quot;</span> <span class="o">+</span> <span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot;(:,end)./1000;&quot;</span><span class="p">])</span>
		<span class="k">else</span><span class="p">:</span>	<span class="c"># is parameterised</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;[bmin, Smin] = fminsearch(@(b)&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">+</span> <span class="s">&quot;_guess&quot;</span> <span class="o">+</span> <span class="s">&quot;(b, tdata, ydata, &quot;</span><span class="o">+</span> <span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> \
			 						<span class="n">m_noprint</span><span class="o">+</span><span class="s">&quot;,&quot;</span><span class="o">+</span><span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot;),b);</span><span class="se">\n</span><span class="s">disp(Smin)&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>										
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="n">mp</span> <span class="o">+</span> <span class="s">&quot; = struct;&quot;</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">yes_guess</span><span class="p">:</span>
				<span class="n">mName</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;bmin&quot;</span> <span class="o">+</span> <span class="n">mName</span><span class="p">[</span><span class="n">elem</span><span class="p">][</span><span class="n">mName</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;(&#39;</span><span class="p">):]</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">pattern_write</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="n">mName</span><span class="p">],[</span><span class="n">mp</span> <span class="o">+</span> <span class="s">&quot;.(&#39;&quot;</span><span class="p">,</span><span class="s">&quot;&#39;) = &quot;</span><span class="p">,</span><span class="s">&quot;; &quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">yes_guess</span><span class="p">)</span>
			
		
		<span class="n">lhs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list</span> <span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_vec</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>	<span class="c"># get a column form dict list</span>
		<span class="n">num_iter</span> <span class="o">=</span> <span class="p">[</span><span class="nb">filter</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">isdigit</span><span class="p">,</span> <span class="n">elem</span><span class="p">)</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">lhs</span><span class="p">]</span>		<span class="c"># get number from derived list</span>
		<span class="n">sto_iter</span> <span class="o">=</span> <span class="p">[</span><span class="n">elem</span><span class="p">[:</span><span class="n">elem</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;(&#39;</span><span class="p">)]</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">lhs</span><span class="p">]</span>		<span class="c"># get the name of storage for each</span>
		<span class="k">if</span> <span class="n">no_guess</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
			<span class="c"># output resultsinto a struct</span>
			<span class="c">#mwrite (mfio, [&quot;[~,&quot; + m_ode + &quot;] = &quot; + self.title + &quot;_ode&quot; + &quot;([],[],[],[],[],[]);&quot;,</span>
			<span class="c">#		m_out + &quot;= struct;&quot;,</span>
			<span class="c">#		m_out + &quot;.ode = t./1000;&quot;])		</span>
			<span class="n">index_ode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;print&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">])</span>		
			<span class="bp">self</span><span class="o">.</span><span class="n">pattern_write</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="n">sto_iter</span><span class="p">,</span> <span class="n">num_iter</span><span class="p">],</span> <span class="p">[</span> <span class="n">m_out</span> <span class="o">+</span> <span class="s">&quot;.(&#39;&quot;</span><span class="p">,</span> <span class="s">&quot;&#39;) = &quot;</span><span class="p">,</span> <span class="s">&quot;(:,&quot;</span><span class="p">,</span><span class="s">&quot;);&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">index_ode</span><span class="p">)</span>
		<span class="c">#mwrite (mfio, m_out + &quot;.ode.(&#39;t&#39;) = t./1000;&quot;, &quot;\n\n&quot;)		</span>
			<span class="n">index_var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;no&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;print&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">])</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">pattern_write</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="n">sto_iter</span><span class="p">,</span> <span class="n">num_iter</span><span class="p">],</span> <span class="p">[</span> <span class="n">m_out</span> <span class="o">+</span> <span class="s">&quot;.(&#39;&quot;</span><span class="p">,</span> <span class="s">&quot;&#39;) = &quot;</span><span class="p">,</span> <span class="s">&quot;(:,&quot;</span><span class="p">,</span><span class="s">&quot;);&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">index_var</span><span class="p">)</span>		
		<span class="c">#mwrite (mfio, m_out + &quot;.var.(&#39;t&#39;) = &quot; + m_print + &quot;(:,end)./1000;&quot;, &quot;\n\n&quot;)</span>
		
		<span class="bp">self</span><span class="o">.</span><span class="n">close_file</span> <span class="p">(</span><span class="n">mfio</span><span class="p">)</span>




</div>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	CREATE ODE-FILE MATLAB FILE FUNCTION</span>
<span class="sd">	the actual ODE system set up as a separate m file</span>
<span class="sd">	for passing into an ODE system</span>
<span class="sd">	&quot;&quot;&quot;</span>	
<div class="viewcode-block" id="MatlabParser.multi_odefile"><a class="viewcode-back" href="../../eqparse.html#eqparse.matlabparser.MatlabParser.multi_odefile">[docs]</a>	<span class="k">def</span> <span class="nf">multi_odefile</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newSubDirectory</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
						<span class="n">file_ext</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> 
						<span class="n">no_guess</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> 
						<span class="n">yes_guess</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> 
						<span class="n">wr_modifiers</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Create matlab ODE file (ode.m) to be used with :py:mod:`multi_runfile` and :py:mod:`multi_runfile_slider` modules&quot;&quot;&quot;</span>

						
		<span class="n">mfile</span> <span class="o">=</span> <span class="s">&quot;ode&quot;</span> <span class="o">+</span> <span class="n">file_ext</span>
		<span class="n">mfio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="n">newSubDirectory</span> <span class="o">+</span>  <span class="s">&quot;ode&quot;</span> <span class="o">+</span> <span class="n">file_ext</span>
		<span class="n">mcomment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_comment</span>
		<span class="n">mwrite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span>
		<span class="n">m_print</span> <span class="o">=</span> <span class="s">&quot;p_store&quot;</span>	<span class="c"># VC_NAME_PRINT</span>
		<span class="n">m_noprint</span> <span class="o">=</span> <span class="s">&quot;p&quot;</span>	<span class="c"># VEC_NAME</span>
		<span class="n">m_ode</span> <span class="o">=</span> <span class="s">&quot;dydt&quot;</span>	<span class="c"># ode var ODE_NAME</span>
		<span class="n">m_ode_rhs</span> <span class="o">=</span> <span class="s">&quot;y&quot;</span> <span class="c"># rhs dydt as y</span>
		<span class="n">mpersistent_out</span> <span class="o">=</span> <span class="s">&quot;out_&quot;</span> <span class="o">+</span> <span class="n">m_print</span>
		<span class="n">mpersistent_temp</span> <span class="o">=</span> <span class="s">&quot;pers_&quot;</span> <span class="o">+</span> <span class="n">m_print</span>
		<span class="n">len_of_odes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">]))</span>
		
		<span class="c"># open file</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">open_file</span> <span class="p">(</span><span class="n">mfio</span><span class="p">)</span>

		<span class="c"># define header (function name etc)</span>
		<span class="k">if</span> <span class="n">yes_guess</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">new_arg</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span> <span class="n">temp</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span> <span class="n">jo</span> <span class="o">=</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">mpersistent_out</span>
		<span class="k">else</span><span class="p">:</span> <span class="n">new_arg</span> <span class="o">=</span> <span class="s">&quot;b&quot;</span><span class="p">;</span> <span class="n">temp</span> <span class="o">=</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">new_arg</span><span class="p">;</span> <span class="n">jo</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;function [&quot;</span> <span class="o">+</span> <span class="n">m_ode</span> <span class="o">+</span>  <span class="n">jo</span> <span class="o">+</span> <span class="s">&quot;] = &quot;</span> <span class="o">+</span> <span class="n">mfile</span> <span class="o">+</span> 
										<span class="s">&quot;(t,&quot;</span> <span class="o">+</span> <span class="n">m_ode_rhs</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">m_noprint</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">m_print</span> <span class="o">+</span> <span class="n">temp</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>
										

		
		
		<span class="k">if</span> <span class="n">yes_guess</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>								
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;persistent &quot;</span> <span class="o">+</span> <span class="n">mpersistent_temp</span> <span class="o">+</span> <span class="s">&quot; counter&quot;</span><span class="p">,</span>
							<span class="s">&quot;if isempty(&quot;</span> <span class="o">+</span> <span class="n">mpersistent_temp</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span><span class="p">,</span> 
							<span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">mpersistent_temp</span> <span class="o">+</span> <span class="s">&quot; = zeros(200,size(&quot;</span> <span class="o">+</span> <span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot;,2));</span><span class="se">\n\t</span><span class="s">counter = 1;&quot;</span><span class="p">,</span>
							<span class="s">&quot;end&quot;</span><span class="p">],</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="p">)</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;if mod(counter-1,200) == 0&quot;</span><span class="p">,</span>
							<span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">mpersistent_temp</span> <span class="o">+</span> <span class="s">&quot; = [&quot;</span> <span class="o">+</span> <span class="n">mpersistent_temp</span> <span class="o">+</span> <span class="s">&quot;; zeros(200,size(&quot;</span> <span class="o">+</span> <span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot;,2))];&quot;</span><span class="p">,</span>
							<span class="s">&quot;end&quot;</span><span class="p">],</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>		
		
			<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;solve the ode step...&quot;</span><span class="p">)</span>
			
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot; = zeros(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">len_of_odes</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;,1);&quot;</span><span class="p">])</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;if (nargout == 1)&quot;</span><span class="p">)</span>

		<span class="k">if</span> <span class="n">yes_guess</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
		<span class="c"># if guess</span>
			<span class="n">oderhs_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorise_name</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;var&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;print&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">]),</span> <span class="s">&quot;p_store&quot;</span><span class="p">)</span>
			<span class="n">oderhs_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorise_name</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;var&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;print&#39;</span><span class="p">][</span><span class="s">&#39;no&#39;</span><span class="p">]),</span> <span class="s">&quot;p&quot;</span><span class="p">,</span> <span class="n">oderhs_names</span><span class="p">)</span>
			<span class="n">oderhs_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorise_name</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">],</span> <span class="s">&quot;y&quot;</span><span class="p">,</span> <span class="n">oderhs_names</span><span class="p">)</span>
			<span class="n">m_rhs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_and_replace</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_list</span> <span class="p">(</span><span class="s">&quot;rhs&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="n">oderhs_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">yes_guess_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_only_names</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">,</span> <span class="n">yes_guess</span><span class="p">)</span>
			<span class="n">no_guess_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_only_names</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">,</span> <span class="n">yes_guess</span><span class="p">)</span>
			<span class="c"># vectorize data</span>
			<span class="n">vnames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorise_name</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;var&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;print&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">]),</span> <span class="s">&quot;p_store&quot;</span><span class="p">)</span>
			<span class="n">vnames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorise_name</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;var&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;print&#39;</span><span class="p">][</span><span class="s">&#39;no&#39;</span><span class="p">]),</span> <span class="s">&quot;p&quot;</span><span class="p">,</span> <span class="n">vnames</span><span class="p">)</span>
			<span class="n">vnames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorise_name</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">],</span> <span class="s">&quot;dydt&quot;</span><span class="p">,</span> <span class="n">vnames</span><span class="p">)</span>
			<span class="n">cntr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vec_counter_start</span>
			<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">yes_guess</span><span class="p">:</span>
				<span class="n">vnames</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;b(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cntr</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span>
				<span class="n">cntr</span> <span class="o">=</span> <span class="n">cntr</span> <span class="o">+</span> <span class="mi">1</span>			
			<span class="n">m_rhs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_and_replace</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_list</span> <span class="p">(</span><span class="s">&quot;rhs&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="n">vnames</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
			
			
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot;(end) = t;&quot;</span><span class="p">)</span>
		<span class="n">setODEFormatAs</span> <span class="o">=</span> <span class="mi">2</span>
		<span class="c"># 1: old format, based on function</span>
		<span class="c"># 2: new format, ordering dependent</span>
		<span class="k">if</span> <span class="n">setODEFormatAs</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
		<span class="c"># ORIGINAL ODE/PARAM UPDATE</span>
			<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;function&#39;</span><span class="p">])):</span>
				<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;function&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">],</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">pattern_write</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="n">m_rhs</span><span class="p">,</span> <span class="s">&quot;comment&quot;</span><span class="p">],</span> <span class="p">[</span> <span class="s">&quot; &quot;</span><span class="p">,</span> <span class="s">&quot; = &quot;</span><span class="p">,</span> <span class="s">&quot;; %&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_vec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;function&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;index&#39;</span><span class="p">])</span>
		<span class="k">elif</span> <span class="n">setODEFormatAs</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
			<span class="n">index_nonode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_dependancy_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;no&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;rhs&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">]),</span><span class="s">&#39;rhs&#39;</span><span class="p">)</span>
			<span class="c">#for indexer in index_nonode:</span>
			<span class="c">#	print self.data[indexer][&#39;rhs&#39;]</span>
			<span class="c"># print all function related dependencies in front of order</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">pattern_write</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="n">m_rhs</span><span class="p">,</span> <span class="s">&quot;comment&quot;</span><span class="p">],</span> <span class="p">[</span> <span class="s">&quot; &quot;</span><span class="p">,</span> <span class="s">&quot; = &quot;</span><span class="p">,</span> <span class="s">&quot;; %&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_vec</span><span class="p">,</span> <span class="n">index_nonode</span><span class="p">)</span>
			<span class="c"># print all ODE related dependencies out to file in last order</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">pattern_write</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="n">m_rhs</span><span class="p">,</span> <span class="s">&quot;comment&quot;</span><span class="p">],</span> <span class="p">[</span> <span class="s">&quot; &quot;</span><span class="p">,</span> <span class="s">&quot; = &quot;</span><span class="p">,</span> <span class="s">&quot;; %&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_vec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">])</span>			
			<span class="c">#new_dependancy_index	</span>
			<span class="c">#mIndex_nonode = self.order_index (self.new_index(self.index[&#39;ode&#39;][&#39;no&#39;],self.index[&#39;rhs&#39;][&#39;yes&#39;]))</span>
			<span class="c">#mIndex_ode = self.order_index (self.index[&#39;ode&#39;][&#39;yes&#39;])</span>
			<span class="c">#self.pattern_write (mfio, [&quot;name&quot;, m_rhs, self.names, &quot;comment&quot;], [ &quot; &quot;, &quot; = &quot;, &quot;; % {&quot;, &quot;} &quot;, &quot; &quot;], self.data_vec, mIndex_nonode)</span>
			<span class="c">#self.pattern_write (mfio, [&quot;name&quot;, m_rhs, self.names, &quot;comment&quot;], [ &quot; &quot;, &quot; = &quot;, &quot;; % {&quot;, &quot;} &quot;, &quot; &quot;], self.data_vec, mIndex_ode)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">None</span>		
		
		
		<span class="k">if</span> <span class="n">yes_guess</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
			<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;...otherwise sort the persistent storage out&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="n">mpersistent_temp</span> <span class="o">+</span> <span class="s">&quot;(counter,:) = &quot;</span> <span class="o">+</span> <span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot;;&quot;</span><span class="p">,</span>
							<span class="s">&quot;counter = counter + 1;&quot;</span><span class="p">])</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;else&quot;</span><span class="p">,</span>
						<span class="s">&quot;</span><span class="se">\t</span><span class="s"> &quot;</span> <span class="o">+</span> <span class="n">mpersistent_out</span> <span class="o">+</span> <span class="s">&quot; = &quot;</span> <span class="o">+</span> <span class="n">mpersistent_temp</span> <span class="o">+</span> <span class="s">&quot;;&quot;</span><span class="p">,</span>
                                                <span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">mpersistent_temp</span> <span class="o">+</span> <span class="s">&quot; = [];&quot;</span><span class="p">,</span>
						<span class="s">&quot;end&quot;</span><span class="p">])</span>
						
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;end </span><span class="si">% e</span><span class="s">nd ode function&quot;</span><span class="p">)</span>		
				
		<span class="bp">self</span><span class="o">.</span><span class="n">close_file</span> <span class="p">(</span><span class="n">mfio</span><span class="p">)</span>




		
		





</div>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	CREATE PARAM-FILE MATLAB FILE FUNCTION</span>
<span class="sd">	is a function which returns all the parameters defined to pass into</span>
<span class="sd">	other functions where parameters need defining</span>
<span class="sd">	Currently used in single-file and multi-run-file m files</span>
<span class="sd">	&quot;&quot;&quot;</span>		
<div class="viewcode-block" id="MatlabParser.multi_paramfile"><a class="viewcode-back" href="../../eqparse.html#eqparse.matlabparser.MatlabParser.multi_paramfile">[docs]</a>	<span class="k">def</span> <span class="nf">multi_paramfile</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newSubDirectory</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">file_ext</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">no_guess</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">yes_guess</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
		
		<span class="c">#if no_guess is None: no_guess = self.[&#39;range&#39;]</span>
		<span class="c">#if no_guess is not None:</span>
		<span class="c">#	print len(no_guess)</span>
		<span class="c"># helper variables</span>
		<span class="c">#mfile = &quot;param&quot; + file_ext</span>
		<span class="n">mfile</span> <span class="o">=</span> <span class="s">&quot;param&quot;</span> <span class="o">+</span> <span class="n">file_ext</span>
		<span class="n">mfio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="n">newSubDirectory</span> <span class="o">+</span> <span class="s">&quot;param&quot;</span> <span class="o">+</span> <span class="n">file_ext</span>
		<span class="n">mcomment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_comment</span>
		<span class="n">mwrite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span>
		<span class="n">scalor_p</span> <span class="o">=</span> <span class="s">&quot;set_param&quot;</span>
		<span class="n">info_p</span> <span class="o">=</span> <span class="s">&quot;print_info&quot;</span>
		
		<span class="c"># open file</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">open_file</span> <span class="p">(</span><span class="n">mfio</span><span class="p">)</span>
		
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;initialize the original parameter output&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;function [&quot;</span> <span class="o">+</span> <span class="n">scalor_p</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">info_p</span> <span class="o">+</span>  <span class="s">&quot;] = &quot;</span> <span class="o">+</span> <span class="n">mfile</span><span class="p">,</span> 
						<span class="n">scalor_p</span> <span class="o">+</span> <span class="s">&quot; = struct;&quot;</span><span class="p">,</span>
						<span class="n">info_p</span> <span class="o">+</span> <span class="s">&quot; = struct;&quot;</span><span class="p">])</span>
		<span class="c"># create initialized parameter struct</span>
		<span class="c">#mIndex = self.index[&#39;userdef&#39;][&#39;yes&#39;]</span>
		<span class="c">#self.pattern_write (mfio, [&quot;name&quot;,&quot;init-value&quot;], [scalor_p + &quot;.(&#39;&quot;, &quot;&#39;) = &quot;, &quot;;&quot;], </span>
		<span class="c">#							self.data, mIndex)</span>
		
		<span class="k">if</span> <span class="n">no_guess</span>	<span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> 	<span class="n">mIndex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;order&#39;</span><span class="p">][</span><span class="s">&#39;init-value&#39;</span><span class="p">];</span>
		<span class="k">else</span><span class="p">:</span>					<span class="n">mIndex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_index</span> <span class="p">(</span><span class="n">no_guess</span><span class="p">)</span>
		<span class="n">p_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list</span> <span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">scalor_p</span> <span class="o">+</span> <span class="s">&quot;.(&#39;&quot;</span><span class="p">,</span> <span class="s">&quot;&#39;)&quot;</span><span class="p">)</span> 
		<span class="n">p_rhs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_and_replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_list</span> <span class="p">(</span><span class="s">&#39;init-value&#39;</span><span class="p">),</span> <span class="n">p_list</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">pattern_write</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="n">p_list</span><span class="p">,</span><span class="n">p_rhs</span><span class="p">],</span> <span class="p">[</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot; = &quot;</span><span class="p">,</span> <span class="s">&quot;;&quot;</span><span class="p">],</span> 
									<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">mIndex</span><span class="p">)</span>
		<span class="c">#rhs_list = self.search_and_replace (rhs_list, rhs_names + [&quot;t(iter)&quot;], self.names + [&quot;t&quot;], False)</span>
		
		<span class="c"># store variables that are printed as ode type or var type (for time sake)</span>
		<span class="n">index_ode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;print&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">])</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">pattern_write</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="s">&quot;comment&quot;</span><span class="p">],</span> <span class="p">[</span> <span class="n">info_p</span> <span class="o">+</span> <span class="s">&quot;.(&#39;&quot;</span><span class="p">,</span> <span class="s">&quot;&#39;) = &#39;ode&#39;; % &quot;</span><span class="p">,</span> <span class="s">&quot;;&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">index_ode</span><span class="p">)</span>

		<span class="n">index_var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;no&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;print&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">],</span> <span class="n">mIndex</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">pattern_write</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="s">&quot;comment&quot;</span><span class="p">],</span> <span class="p">[</span> <span class="n">info_p</span> <span class="o">+</span> <span class="s">&quot;.(&#39;&quot;</span><span class="p">,</span> <span class="s">&quot;&#39;) = &#39;var&#39;; % &quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">index_var</span><span class="p">)</span>
		
		<span class="c"># close file</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">close_file</span> <span class="p">(</span><span class="n">mfio</span><span class="p">)</span>
		
		
		</div>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	CREATE PARAMETER ESTIMATE MATLAB FILE</span>
<span class="sd">	For parameter estimates, put into a separate folder</span>
<span class="sd">	with required files. To run, use the actual run.m file</span>
<span class="sd">	&quot;&quot;&quot;</span>		
<div class="viewcode-block" id="MatlabParser.p_est_main"><a class="viewcode-back" href="../../eqparse.html#eqparse.matlabparser.MatlabParser.p_est_main">[docs]</a>	<span class="k">def</span> <span class="nf">p_est_main</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param_to_est</span><span class="p">):</span>
		
		<span class="n">s_direct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="s">&quot;guess&quot;</span><span class="p">;</span>
		<span class="k">print</span> <span class="n">s_direct</span><span class="p">;</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span> <span class="p">(</span><span class="n">s_direct</span><span class="p">):</span>
			<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span> <span class="p">(</span><span class="n">s_direct</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">print</span> <span class="s">&quot;WARNING: over writing folder &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>
		
		<span class="c"># check if param_to_est is contained in value names</span>
		<span class="n">temp</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">param_to_est</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">))</span>
		<span class="k">if</span> <span class="n">temp</span><span class="p">:</span>
			<span class="n">error</span><span class="p">(</span><span class="s">&quot;These values do not exist for parameter estimate &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span>
		<span class="n">n_guess_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">param_to_est</span><span class="p">)))</span>
		<span class="n">y_guess_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">param_to_est</span><span class="p">)</span>
		<span class="n">n_guess</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_index</span><span class="p">(</span><span class="n">n_guess_names</span><span class="p">)</span>
		<span class="n">y_guess</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_index</span><span class="p">(</span><span class="n">y_guess_names</span><span class="p">)</span>
		<span class="c">#mIndex = self.new_index (self.index[&#39;ode&#39;][&#39;no&#39;], self.index[&#39;print&#39;][&#39;yes&#39;])</span>
			
		
		<span class="c">#### DEFINE MAIN EST FILE</span>
		<span class="c">#mfileo = &quot;guess&quot;</span>
		<span class="c">#mfile = mfileo</span>
		<span class="n">mfile</span> <span class="o">=</span> <span class="s">&quot;guess&quot;</span>
		<span class="n">mfio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="s">&quot;guess&quot;</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="s">&quot;guess&quot;</span>
		<span class="n">mcomment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_comment</span>
		<span class="n">mwrite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span>
		<span class="n">mp_est</span> <span class="o">=</span> <span class="s">&quot;b&quot;</span>
		<span class="n">mp_err</span> <span class="o">=</span> <span class="s">&quot;S&quot;</span>
		<span class="n">m_ode</span> <span class="o">=</span> <span class="s">&quot;dydt&quot;</span>
		
		<span class="c"># open file</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">open_file</span> <span class="p">(</span><span class="n">mfio</span><span class="p">)</span>
		
		<span class="c"># start function and create header</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;function S = &quot;</span> <span class="o">+</span> <span class="n">mfile</span> <span class="o">+</span> <span class="s">&quot; (b, tdata, ydata, dydt, p, p_store)&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>
						<span class="c">#&quot;if (nargout) == 2&quot;,</span>
						<span class="c">#&quot;\tout = &quot; + m_ode,</span>
						<span class="c">#&quot;else&quot;],&quot;\n\n&quot;)</span>
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;numerical integration setup&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;tspan = 0:0.02:max(tdata);&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;options = odeset(&#39;InitialStep&#39;,0.02,&#39;MaxStep&#39;,25, &#39;RelTol&#39;, 1e-9, &#39;AbsTol&#39;, 1e-9);&quot;</span><span class="p">)</span>		
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;[t,ysol] = ode15s(@(tt,y)ode_guess(tt,y,p,p_store,b),tspan,dydt,options);&quot;</span><span class="p">)</span>
		
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;find predicted values&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;ypred = interp1 (t,ysol,tdata);&quot;</span><span class="p">)</span>
		<span class="c">#plot_names_index = self.get_index([&quot;V_m&quot;, &quot;Ca_i&quot;, &quot;K_i&quot;, &quot;Na_i&quot;, &quot;Cl_i&quot;, &quot;R_01&quot;])</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;figure(1)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
		<span class="n">cntr</span> <span class="o">=</span> <span class="mi">1</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;V_m&quot;</span><span class="p">,</span> <span class="s">&quot;Ca_i&quot;</span><span class="p">,</span> <span class="s">&quot;Na_i&quot;</span><span class="p">,</span> <span class="s">&quot;K_i&quot;</span><span class="p">,</span> <span class="s">&quot;Cl_i&quot;</span><span class="p">,</span> <span class="s">&quot;R_01&quot;</span><span class="p">]:</span>
			<span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
			<span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_vec</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">data_vec</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;(&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">data_vec</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;)&#39;</span><span class="p">)]</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;subplot(3,2,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cntr</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;)</span><span class="se">\n</span><span class="s">plot(tdata,ydata(:,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;),&#39;x&#39;,&#39;MarkerSize&#39;,10)&quot;</span><span class="p">,</span>
							<span class="s">&quot;hold on&quot;</span><span class="p">,</span>
							<span class="s">&quot;plot(t,ysol(:,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;))&quot;</span><span class="p">,</span>
							<span class="s">&quot;hold off&quot;</span><span class="p">])</span>
			<span class="n">cntr</span> <span class="o">=</span> <span class="n">cntr</span> <span class="o">+</span> <span class="mi">1</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;drawnow&quot;</span><span class="p">)</span>
						<span class="c">#&quot;plot(tdata,ydata(:,end),&#39;x&#39;,&#39;MarkerSize&#39;,10)&quot;,</span>
						<span class="c">#&quot;hold on&quot;,</span>
						<span class="c">#&quot;plot(t,ysol(:,end))&quot;,</span>
						<span class="c">#&quot;hold off&quot;,</span>
						<span class="c">#&quot;drawnow&quot;])</span>
		
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;compute total error&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;S = 0;&quot;</span><span class="p">,</span>
						<span class="s">&quot;for i = 1:length(tdata)&quot;</span><span class="p">,</span>
						<span class="s">&quot;</span><span class="se">\t</span><span class="s">S = S +sum((ypred(i,:)-ydata(i,:)).^2);&quot;</span><span class="p">,</span>
						<span class="s">&quot;end&quot;</span><span class="p">])</span>
			
					
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;end&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>	
		<span class="c">#mcomment (mfio, &quot;Define sample data to fit model here&quot;,&quot;\n&quot;,&quot;\n\n&quot;)	</span>
		<span class="c">#mcomment (mfio, &quot;Get initial conditions here&quot;,&quot;\n&quot;,&quot;\n\n&quot;)	</span>
		<span class="c">#mcomment (mfio, &quot;Initial guess of parameters here&quot;,&quot;\n&quot;,&quot;\n\n&quot;)		</span>
		<span class="c">#mcomment (mfio, &quot;Minimization step&quot;,&quot;\n&quot;,&quot;\n\n&quot;)</span>
		<span class="c">#mcomment (mfio, &quot;output estimated parameters&quot;,&quot;\n&quot;,&quot;\n\n&quot;)</span>
						
		<span class="bp">self</span><span class="o">.</span><span class="n">close_file</span> <span class="p">(</span><span class="n">mfio</span><span class="p">)</span>
		
		<span class="c">### DEFINE PARAM FILE</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">multi_paramfile</span> <span class="p">(</span><span class="s">&quot;guess/&quot;</span><span class="p">,</span> <span class="s">&quot;_g&quot;</span><span class="p">,</span><span class="n">n_guess</span><span class="p">,</span> <span class="n">y_guess</span><span class="p">)</span>
		
		<span class="c">### DEFINE ODE FILE</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">multi_odefile</span> <span class="p">(</span><span class="s">&quot;guess/&quot;</span><span class="p">,</span> <span class="s">&quot;_g&quot;</span><span class="p">,</span> <span class="n">n_guess</span><span class="p">,</span> <span class="n">y_guess</span><span class="p">)</span>
		
		<span class="c">### DEFINE RUN FILE</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">multi_runfile</span> <span class="p">(</span><span class="s">&quot;guess/&quot;</span><span class="p">,</span> <span class="s">&quot;_g&quot;</span><span class="p">,</span> <span class="n">n_guess</span><span class="p">,</span> <span class="n">y_guess</span><span class="p">)</span>
		
		<span class="c">### IC file, based on ODE and initial condition (given steady state is in )	</span>
		<span class="n">create_file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">+</span> <span class="s">&quot;/guess/&quot;</span> <span class="o">+</span> <span class="s">&quot;create_ic&quot;</span>	
		<span class="bp">self</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="n">create_file_name</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">create_file_name</span><span class="p">,</span> <span class="s">&quot;function [tdata, ydata] = create_ic (t_end)&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">create_file_name</span><span class="p">,</span> <span class="s">&quot;create default time and data (assumed to be at steady state)&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">create_file_name</span><span class="p">,</span> <span class="s">&quot;tdata = 0:0.5:t_end;&quot;</span><span class="p">)</span>
		<span class="n">mIndex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;range&#39;</span><span class="p">])</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">pattern_write</span> <span class="p">(</span><span class="n">create_file_name</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="s">&quot;init-value&quot;</span><span class="p">],</span> <span class="p">[</span> <span class="s">&quot; &quot;</span><span class="p">,</span> <span class="s">&quot; = &quot;</span><span class="p">,</span> <span class="s">&quot;;&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">mIndex</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">create_file_name</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
		<span class="n">p_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list</span> <span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span>
		<span class="n">cntr</span> <span class="o">=</span> <span class="mi">1</span>
		<span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">]:</span>
			<span class="n">p_list</span><span class="p">[</span><span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;ydata(:,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cntr</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span>
			<span class="n">cntr</span> <span class="o">=</span> <span class="n">cntr</span> <span class="o">+</span> <span class="mi">1</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">pattern_write</span> <span class="p">(</span><span class="n">create_file_name</span><span class="p">,</span> <span class="p">[</span><span class="n">p_list</span><span class="p">,</span> <span class="s">&#39;init-value&#39;</span><span class="p">],[</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="s">&quot; = &quot;</span><span class="p">,</span> <span class="s">&quot;.*ones(size(tdata)); &quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">])</span>

		<span class="n">mwrite</span> <span class="p">(</span><span class="n">create_file_name</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">close_file</span><span class="p">(</span><span class="n">create_file_name</span><span class="p">)</span>
		





			

		</div>
	<span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>	
	<span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>	
	<span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>	
	<span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
	<span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>	
	<span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>	
	<span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>	
	<span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>	
	<span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>	
	<span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>	
	<span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>	
	<span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>			
	<span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>	
	<span class="sd">&quot;&quot;&quot;			</span>
<span class="sd">	CREATE SLIDER_RUN_FILE MATLAB FILE FUNCTION</span>
<span class="sd">	contains the actual set-up and organisation of cell system</span>
<span class="sd">	in a structured order, is also main file</span>
<span class="sd">	&quot;&quot;&quot;</span>
<div class="viewcode-block" id="MatlabParser.multi_runfile_slider"><a class="viewcode-back" href="../../eqparse.html#eqparse.matlabparser.MatlabParser.multi_runfile_slider">[docs]</a>	<span class="k">def</span> <span class="nf">multi_runfile_slider</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newSubDirectory</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">file_ext</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">no_guess</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">yes_guess</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>

		<span class="c">#mfile = &quot;run&quot; + file_ext</span>
		<span class="n">mfile</span> <span class="o">=</span>  <span class="s">&quot;run_slider&quot;</span> <span class="o">+</span> <span class="n">file_ext</span>
		<span class="n">mfio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="n">newSubDirectory</span> <span class="o">+</span> <span class="s">&quot;run_slider&quot;</span> <span class="o">+</span> <span class="n">file_ext</span>
		<span class="n">mcomment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_comment</span>
		<span class="n">mwrite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span>
		<span class="n">m_print</span> <span class="o">=</span> <span class="s">&quot;p_store&quot;</span>	<span class="c"># VC_NAME_PRINT</span>
		<span class="n">m_noprint</span> <span class="o">=</span> <span class="s">&quot;p&quot;</span>	<span class="c"># VEC_NAME</span>
		<span class="n">m_ode</span> <span class="o">=</span> <span class="s">&quot;dydt&quot;</span>	<span class="c"># ode var ODE_NAME</span>
		<span class="n">m_out</span> <span class="o">=</span> <span class="s">&quot;out&quot;</span>
		<span class="n">m_otime</span><span class="o">=</span> <span class="s">&#39;out_time&#39;</span>
		<span class="n">t_end</span> <span class="o">=</span> <span class="s">&quot;t_end&quot;</span>
		<span class="n">set_p</span> <span class="o">=</span> <span class="s">&quot;initial&quot;</span>
		<span class="n">ode_method</span> <span class="o">=</span> <span class="s">&quot;ode15s&quot;</span>
		<span class="n">m_ode_fname</span> <span class="o">=</span> <span class="s">&quot;ode&quot;</span>
		<span class="n">m_add_events</span> <span class="o">=</span> <span class="s">&quot;passEvents&quot;</span>
		<span class="n">m_struct</span> <span class="o">=</span> <span class="s">&quot;options&quot;</span>
		<span class="c"># open file</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">open_file</span> <span class="p">(</span><span class="n">mfio</span><span class="p">)</span>
		
		<span class="c"># define header</span>
		<span class="k">if</span> <span class="n">yes_guess</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">mp</span> <span class="o">=</span> <span class="n">m_out</span>
		<span class="k">else</span><span class="p">:</span> <span class="n">mp</span> <span class="o">=</span> <span class="s">&quot;b_out&quot;</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;function [&quot;</span> <span class="o">+</span> <span class="n">mp</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">set_p</span> <span class="o">+</span> <span class="s">&quot;] = &quot;</span> <span class="o">+</span> <span class="n">mfile</span> <span class="o">+</span> <span class="s">&quot; (&quot;</span> \
							<span class="o">+</span> <span class="n">set_p</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">m_add_events</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">m_struct</span> \
							<span class="o">+</span> <span class="s">&quot;)</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>
		<span class="c">#					+ set_p + &quot;, &quot; + t_end + &quot;, b_in)&quot;, &quot;\n\n&quot;)	</span>
		
		<span class="c">#</span>
		<span class="c"># persistent variables</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;persistent name_only type_only iter_only&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>
		
		
		<span class="c"># set options as nothing here</span>
		
		<span class="c">#</span>
		<span class="c"># NOTE: this is the extra commands for slider version of run</span>
		<span class="c">#</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span><span class="s">&quot;if nargout==2&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
				
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">out = {};&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>		
		<span class="c"># initial params : get initial params only (for slider)</span>
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">initialize the original parameter output&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">set_p</span> <span class="o">+</span> <span class="s">&#39; = get_ic;&#39;</span><span class="p">)</span>

		<span class="c">#if no_guess	is None: 	mIndex = self.order_index(self.index[&#39;userdef&#39;][&#39;yes&#39;]) #self.index[&#39;order&#39;][&#39;init-value&#39;];</span>
		<span class="c">#else:					mIndex = self.order_index (no_guess)</span>
		
		<span class="n">mIndex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;userdef&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">])</span>
		<span class="n">mIndex_odeyes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_index</span><span class="p">(</span><span class="n">mIndex</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">])</span>
		<span class="n">mIndex_odeno</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_index</span><span class="p">(</span><span class="n">mIndex</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;no&#39;</span><span class="p">])</span>
		<span class="c">#for elem in yes_guess:</span>
		<span class="c">#	mName[elem] = &quot;b(&quot; + str(cntr) + &quot;)&quot;</span>
		<span class="c">#	cntr = cntr + 1</span>
		
		<span class="c">##p_list = self.get_list (&#39;name&#39;, self.data, set_p + &quot;.&quot;,&quot;&quot;)</span>
		<span class="n">p_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list</span> <span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">mIndex_odeyes</span><span class="p">:</span>
			<span class="n">p_list</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="n">set_p</span> <span class="o">+</span> <span class="n">p_list</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span>
		<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">mIndex_odeno</span><span class="p">:</span>
			<span class="n">p_list</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="n">set_p</span> <span class="o">+</span> <span class="n">p_list</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span>
		
		<span class="n">p_rhs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_and_replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_list</span> <span class="p">(</span><span class="s">&#39;init-value&#39;</span><span class="p">),</span> <span class="n">p_list</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="p">)</span>
		<span class="c">#self.pattern_write (mfio, [p_list,p_rhs], [&quot;&quot;, &quot; = &quot;, &quot;;&quot;], </span>
		<span class="c">#							self.data, mIndex)</span>
		
		<span class="c"># print info not used in this file. is a waste for in house slider [?]</span>
		<span class="c"># store variables that are printed as ode type or var type (for time sake)</span>
		<span class="c">#index_ode = self.new_index(self.index[&#39;ode&#39;][&#39;yes&#39;], self.index[&#39;print&#39;][&#39;yes&#39;])</span>
		<span class="c">#self.pattern_write (mfio, [&quot;name&quot;, &quot;comment&quot;], [ info_p + &quot;.(&#39;&quot;, &quot;&#39;) = &#39;ode&#39;; % &quot;, &quot;;&quot;], self.data, index_ode)</span>
		<span class="c">#index_var = self.new_index(self.index[&#39;ode&#39;][&#39;no&#39;], self.index[&#39;print&#39;][&#39;yes&#39;], mIndex)</span>
		<span class="c">#self.pattern_write (mfio, [&quot;name&quot;, &quot;comment&quot;], [ info_p + &quot;.(&#39;&quot;, &quot;&#39;) = &#39;var&#39;; % &quot;, &quot;&quot;], self.data, index_var)</span>
		
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;else&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>
		<span class="c">#</span>
		<span class="c">#</span>
		<span class="c">#</span>
		<span class="c">#print &quot;wooooooo&quot;</span>
		<span class="c">#print str(len(self.index[&#39;ode&#39;][&#39;yes&#39;]))</span>
		<span class="c">#print str(len(self.new_index(self.index[&#39;rhs&#39;][&#39;no&#39;])))</span>
		<span class="c">#print str(len(self.new_index(self.index[&#39;ode&#39;][&#39;no&#39;],self.index[&#39;rhs&#39;][&#39;yes&#39;])))</span>
		
		<span class="c">## preallocate storage</span>
		<span class="c">#mI_user_no_ode = self.new_index(self.index[&#39;print&#39;][&#39;no&#39;],self.index[&#39;ode&#39;][&#39;no&#39;])</span>
		<span class="c">#mI_uder_no_ode_but_print = self.new_index(self.index[&#39;print&#39;][&#39;yes&#39;],self.index[&#39;ode&#39;][&#39;no&#39;])</span>
		<span class="c">#mcomment (mfio, &quot;preallocate storage for data&quot;)</span>
		<span class="c">#mwrite (mfio, [m_noprint + &quot; = zeros(1,&quot; + str(len(mI_user_no_ode)) + &quot;);&quot;,</span>
		<span class="c">#				m_print + &quot; = zeros(1,&quot; + str(len(mI_uder_no_ode_but_print)+1) + &quot;);&quot;,</span>
		<span class="c">#				m_ode + &quot; = zeros(1,&quot; + str(len(self.index[&#39;ode&#39;][&#39;yes&#39;])) +&quot;);&quot;])</span>

		<span class="c"># if parameterizing it, create initial data from external function</span>
		<span class="c"># and define parameter initial values also</span>
		<span class="k">if</span> <span class="n">no_guess</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
			<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;Define sample data to fit model here ()&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;[tdata,ydata] = create_ic (t_end);&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">if nargin&lt;3&quot;</span><span class="p">)</span>
			<span class="n">mName</span> <span class="o">=</span> <span class="p">[</span><span class="n">elem</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">];</span> <span class="n">cntr</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">yes_guess</span><span class="p">:</span>
				<span class="n">mName</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;b(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cntr</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span>
				<span class="n">cntr</span> <span class="o">=</span> <span class="n">cntr</span> <span class="o">+</span> <span class="mi">1</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">pattern_write</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="n">mName</span><span class="p">,</span> <span class="s">&quot;init-value&quot;</span><span class="p">,</span> <span class="s">&quot;comment&quot;</span><span class="p">],</span> <span class="p">[</span> <span class="s">&quot; &quot;</span><span class="p">,</span> <span class="s">&quot; = &quot;</span><span class="p">,</span> <span class="s">&quot;; </span><span class="se">\t</span><span class="s">% &quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_vec</span><span class="p">,</span> <span class="n">yes_guess</span><span class="p">)</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;else</span><span class="se">\n\t</span><span class="s">b=b_in</span><span class="se">\n</span><span class="s">end&quot;</span><span class="p">)</span>

									
		<span class="c"># ..user defined args</span>
		
		<span class="c">##struct_vec_names = self.get_list (&quot;name&quot;, self.data_vec)</span>
		<span class="c">##t_end_vec = struct_vec_names[self.names.index(t_end)]</span>
		<span class="c">#struct_vec_names[index_tend] = t_end</span>
		<span class="c">#struct_vec_names = &quot;name&quot;</span>
		
		<span class="c">#struct_names = self.new_names(self.names, self.index[&#39;userdef&#39;][&#39;yes&#39;], [set_p + &quot;.&quot;,&quot;&quot;])</span>
		<span class="c">#self.pattern_write (mfio, [&quot;name&quot;, p_list, &quot;comment&quot;], [ &quot; &quot;, &quot; = &quot;, &quot;; % &quot;, &quot;&quot;], self.data_vec, self.index[&#39;userdef&#39;][&#39;yes&#39;])	</span>
		<span class="c">## .. function dependent</span>
		<span class="c">#mIndex = self.order_index(self.index[&#39;userdef&#39;][&#39;no&#39;])</span>
		<span class="c">#self.pattern_write (mfio, [&quot;name&quot;, &quot;init-value&quot;, &quot;comment&quot;], [ &quot; &quot;, &quot; = &quot;, &quot;; % &quot;, &quot;&quot;], self.data_vec, mIndex)</span>
		<span class="c"># this is for the time output</span>
		<span class="c">#mwrite (mfio, [m_print + &quot;(&quot; + str(len(mI_uder_no_ode_but_print) + 1) + &quot;) = 0;&quot; ])</span>

		<span class="c"># initialise data for system run</span>
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;initialise the data prior to ode solver run&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span><span class="s">&quot;[&quot;</span> <span class="o">+</span> <span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">m_noprint</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot;] = initialise_data(&quot;</span> <span class="o">+</span> <span class="n">set_p</span> <span class="o">+</span> <span class="s">&quot;);</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>		

		<span class="c">#A = self.get_list (&quot;name&quot;);</span>
		<span class="c">#Avec = self.get_list (&quot;name&quot;, self.data_vec);</span>
		<span class="c">##index_debug = self.new_index(self.index[&#39;ode&#39;][&#39;no&#39;],self.index[&#39;print&#39;][&#39;no&#39;]) + \</span>
		<span class="c">#index_debug = self.new_index(self.index[&#39;print&#39;][&#39;yes&#39;]) #+ \</span>
		<span class="c">#	#self.new_index(self.index[&#39;ode&#39;][&#39;yes&#39;]);</span>
		
		<span class="c">#for elem in index_debug:</span>
		<span class="c">#	print A[elem] + &quot;:&quot; + Avec[elem]</span>
			
				
		<span class="c">#vec_names = []</span>
		<span class="c">#for elem in self.data_vec:</span>
		<span class="c">#	vec_names.append(elem[&#39;name&#39;]) # get new vec names list</span>
		<span class="c">#vec_names = [elem[&#39;name&#39;] for elem in self.data_vec]</span>
		
		<span class="c">#index_only_p = self.new_index(self.index[&#39;ode&#39;][&#39;no&#39;], self.index[&#39;userdef&#39;][&#39;yes&#39;])</span>
		<span class="c">#iter_only_p = self.new_names_restricted(vec_names,index_only_p)</span>
		<span class="c">#names_only_p = self.new_names_restricted(self.names,index_only_p)</span>
		<span class="c">#print names_only_p</span>
		<span class="c">#for i in range(len(names_only_p)):</span>
		<span class="c">#	iter_only_p[i] = int(re.search(&#39;\((.*)\)&#39;, iter_only_p[i]).group(1))</span>

		<span class="c">#index_only_dydt = self.new_index (self.index[&#39;ode&#39;][&#39;yes&#39;])</span>
		<span class="c">#iter_only_dydt = self.new_names_restricted(vec_names, self.index[&#39;ode&#39;][&#39;yes&#39;])</span>
		<span class="c">#names_only_dydt = self.new_names_restricted(self.names, self.index[&#39;ode&#39;][&#39;yes&#39;])</span>
		<span class="c">#for i in range(len(names_only_dydt)):</span>
		<span class="c">#	iter_only_dydt[i] = int(re.search(&#39;\((.*)\)&#39;, iter_only_dydt[i]).group(1))		</span>
		<span class="c">#</span>
		<span class="c">#mwrite (mfio, &quot;\nnum_p = [&quot; , &quot;&quot;, &quot;&quot;)</span>
		<span class="c">#for i in range(len(names_only_dydt)-1):</span>
		<span class="c">#	mwrite (mfio, &quot;,&quot; + names_only_</span>
		
		<span class="n">iter_only</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;\((.*)\)&#39;</span><span class="p">,</span> <span class="n">elem</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_vec</span><span class="p">]</span>
		<span class="n">type_only</span> <span class="o">=</span> <span class="p">[</span><span class="n">elem</span><span class="p">[:</span><span class="n">elem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;(&#39;</span><span class="p">)]</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="p">[</span><span class="n">elem</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_vec</span><span class="p">]]</span>		
		<span class="c"># print the names</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">if isempty(name_only)</span><span class="se">\n\t</span><span class="s">name_only = {&quot;</span> <span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iter_only</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;&#39;&quot;</span> <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;&#39;};</span><span class="se">\n</span><span class="s">end&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>
		<span class="c"># print the types</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">if isempty(type_only)</span><span class="se">\n\t</span><span class="s">type_only = {&quot;</span> <span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iter_only</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="n">type_only</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;&#39;&quot;</span>  <span class="o">+</span> <span class="s">&quot;,&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="n">type_only</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;&#39;};</span><span class="se">\n</span><span class="s">end&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>
		<span class="c"># print the iters</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">if isempty(iter_only)</span><span class="se">\n\t</span><span class="s">iter_only = [&quot;</span> <span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iter_only</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="n">iter_only</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="n">iter_only</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;];</span><span class="se">\n</span><span class="s">end&quot;</span><span class="p">)</span>
				<span class="c"># myString[myString.find(&quot;!&quot;)+1:myString.find(&quot;@&quot;)]</span>
					
<span class="c"># s[len(start):-len(end)]</span>

		<span class="c"># predefine time, if no input given</span>
		<span class="c"># mwrite (mfio, [&quot;if nargin&lt;2&quot;, &quot;\t&quot; + t_end + &quot; = &quot; + set_p + &quot;.&quot; + t_end + &quot;;&quot;, &quot;end\n&quot;])		</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="n">t_end</span> <span class="o">+</span> <span class="s">&quot; = &quot;</span> <span class="o">+</span> <span class="n">set_p</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span> <span class="o">+</span> <span class="n">t_end</span> <span class="o">+</span> <span class="s">&quot;;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">])</span>		
		<span class="c"># add events (m_add_events is passEvents)</span>
		<span class="n">m_size_add_events</span> <span class="o">=</span> <span class="s">&quot;size_&quot;</span> <span class="o">+</span> <span class="n">m_add_events</span>
		<span class="n">m_add_events_vec</span> <span class="o">=</span> <span class="s">&quot;time_vec&quot;</span>
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;set up static events module if not defined&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;if nargin==1</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span> \
				<span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">m_add_events</span> <span class="o">+</span> <span class="s">&quot;.time = []; % time point step all &lt; t_end [vector]</span><span class="se">\n</span><span class="s">&quot;</span> \
				<span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">m_add_events</span> <span class="o">+</span> <span class="s">&quot;.change = {[]}; </span><span class="si">% c</span><span class="s">hanges to parameter values [vector]</span><span class="se">\n</span><span class="s">&quot;</span> \
				<span class="s">&quot;elseif nargin==2</span><span class="se">\n</span><span class="s">&quot;</span> \
				<span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">m_add_events</span> <span class="o">+</span> <span class="s">&quot;.change = {[],&quot;</span> <span class="o">+</span> <span class="n">m_add_events</span> <span class="o">+</span> <span class="s">&quot;.change{:}};</span><span class="se">\n</span><span class="s">&quot;</span> \
				<span class="s">&quot;end</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="n">m_add_events_vec</span> <span class="o">+</span> <span class="s">&quot; = [0,&quot;</span> <span class="o">+</span> <span class="n">m_add_events</span> <span class="o">+</span> <span class="s">&quot;.time,t_end];&quot;</span><span class="p">)</span>
		
		<span class="c"># start ode</span>
		<span class="n">m_print_out</span> <span class="o">=</span> <span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot;_all&quot;</span>
		<span class="k">if</span> <span class="n">no_guess</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
			<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;solve ode set through event set&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;t=[];</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">m_print_out</span> <span class="o">+</span> <span class="s">&quot;=&quot;</span> <span class="o">+</span> <span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot;;&quot;</span><span class="p">)</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;options_ode = odeset(&#39;InitialStep&#39;,0.02,&#39;MaxStep&#39;,250, &#39;RelTol&#39;, 1e-9, &#39;AbsTol&#39;, 1e-9);&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;for i=1:numel(&quot;</span> <span class="o">+</span> <span class="n">m_add_events_vec</span> <span class="o">+</span> <span class="s">&quot;)-1</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>			
			<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;change parameter&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n\t</span><span class="s">&quot;</span><span class="p">)</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">CHANGICALS = &quot;</span> <span class="o">+</span> <span class="n">m_add_events</span> <span class="o">+</span> <span class="s">&quot;.change{i};</span><span class="se">\n</span><span class="s">&quot;</span> \
					<span class="s">&quot;    for j=1:numel(CHANGICALS)</span><span class="se">\n</span><span class="s">&quot;</span> \
					<span class="s">&quot;        niter = strmatch(CHANGICALS{j}{1},name_only,&#39;exact&#39;);</span><span class="se">\n</span><span class="s">&quot;</span> \
					<span class="s">&quot;        switch type_only{niter}</span><span class="se">\n</span><span class="s">&quot;</span> \
					<span class="s">&quot;            case &#39;&quot;</span> <span class="o">+</span> <span class="n">m_noprint</span> <span class="o">+</span> <span class="s">&quot;&#39;</span><span class="se">\n</span><span class="s">&quot;</span> \
					<span class="s">&quot;                &quot;</span> <span class="o">+</span> <span class="n">m_noprint</span> <span class="o">+</span> <span class="s">&quot;(iter_only(niter)) = CHANGICALS{j}{2};</span><span class="se">\n</span><span class="s">&quot;</span> 
					<span class="s">&quot;            case &#39;&quot;</span> <span class="o">+</span> <span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot;&#39;</span><span class="se">\n</span><span class="s">&quot;</span> \
					<span class="s">&quot;                &quot;</span> <span class="o">+</span> <span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot;(end,iter_only(niter)) = CHANGICALS{j}{2};</span><span class="se">\n</span><span class="s">&quot;</span> 
					<span class="s">&quot;            case &#39;&quot;</span> <span class="o">+</span> <span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot;&#39;</span><span class="se">\n</span><span class="s">&quot;</span> \
					<span class="s">&quot;                &quot;</span> <span class="o">+</span> <span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot;(end,iter_only(niter)) = CHANGICALS{j}{2};</span><span class="se">\n</span><span class="s">&quot;</span> 
					<span class="s">&quot;        end</span><span class="se">\n</span><span class="s">&quot;</span> \
					<span class="s">&quot;    end</span><span class="se">\n</span><span class="s">&quot;</span> \
					<span class="p">,</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>
					<span class="c">#&quot;\t&quot; + 	&quot;for j=1:numel(CHANGICALS)\n&quot; \</span>
					<span class="c">#&quot;\t\t&quot; +	&quot;if strcmp(CHANGICALS{j}{2},&#39;dydt&#39;)\n&quot; \</span>
					<span class="c">#&quot;\t\t\t&quot; +		&quot;dydt{dydt_iter{CHANGICALS{j}{1}}} = CHANGICALS{j}{2});\n&quot; \</span>
					<span class="c">#&quot;\t\t&quot; + 	&quot;elseif strcmp(CHANGICALS{j}{2},&#39;p&#39;)\n&quot; \</span>
					<span class="c">#&quot;\t\t\t&quot; +		&quot;p{p_iter{CHANGICALS{j}{1}}} = CHANGICALS{j}{2});\n&quot; \</span>
					<span class="c">#&quot;\t\t&quot; + 	&quot;end\n&quot; \</span>
					<span class="c">#&quot;\t&quot; +	&quot;end&quot; \</span>
					<span class="c">#	,&quot;\n\n&quot;,&quot;&quot;)</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">[t_temp,&quot;</span> <span class="o">+</span> <span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot;_temp] = &quot;</span> <span class="o">+</span> <span class="n">ode_method</span> <span class="o">+</span> <span class="s">&quot;(@(tt,y)&quot;</span> <span class="o">+</span> <span class="n">m_ode_fname</span> <span class="o">+</span> <span class="s">&quot;(tt,y,&quot;</span> 
						<span class="o">+</span> <span class="n">m_noprint</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">m_print_out</span> <span class="o">+</span> <span class="s">&quot;(end,:)),...</span><span class="se">\n\t\t</span><span class="s">&quot;</span>
						<span class="o">+</span> <span class="n">m_add_events_vec</span> <span class="o">+</span> <span class="s">&quot;(i:i+1)&#39;.*1000,&quot;</span> <span class="o">+</span> <span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot;(end,:),options_ode);&quot;</span><span class="p">)</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">[~,&quot;</span> <span class="o">+</span> <span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot;] = &quot;</span> <span class="o">+</span> <span class="n">m_ode_fname</span> <span class="o">+</span> <span class="s">&quot;([],[],[],[]);&quot;</span><span class="p">)</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">[~, index_max_t_] = max(&quot;</span> <span class="o">+</span> <span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot;(:,end));&quot;</span><span class="p">)</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">m_print_out</span> <span class="o">+</span> <span class="s">&quot; = [&quot;</span> <span class="o">+</span> <span class="n">m_print_out</span> <span class="o">+</span> <span class="s">&quot;;&quot;</span> <span class="o">+</span> <span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot;(1:index_max_t_,:)]; </span><span class="si">%#o</span><span class="s">k&lt;AGROW&gt;&quot;</span><span class="p">)</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot; = [&quot;</span> <span class="o">+</span> <span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot;;&quot;</span> <span class="o">+</span> <span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot;_temp(1:end-1,:)]; </span><span class="si">%#o</span><span class="s">k&lt;AGROW&gt;&quot;</span><span class="p">)</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">t = [t(1:end-1) t_temp&#39;];&quot;</span><span class="p">)</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;end&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>
		<span class="c">#	mwrite (mfio, &quot;t=[t&#39;,t_end*1000];&quot;,&quot;\n\n&quot;)</span>
		<span class="c">#	mwrite (mfio, [&quot;options = odeset(&#39;InitialStep&#39;,0.2,&#39;MaxStep&#39;,500, &#39;RelTol&#39;, 1e-9, &#39;AbsTol&#39;, 1e-9);&quot;,</span>
		<span class="c">#					&quot;[t,&quot; + m_ode + &quot;] = &quot; + ode_method + &quot;(@(tt,y)&quot; + m_ode_fname + &quot;(tt,y,&quot; </span>
		<span class="c">#							+ m_noprint + &quot;,&quot; + m_print + &quot;),&quot; +</span>
		<span class="c">#						&quot;[0,&quot; + t_end + &quot;*1000],&quot; + m_ode + &quot;,options);&quot;],&quot;\n&quot;,&quot;\n\n&quot;)</span>
			<span class="c"># output resultsinto a struct</span>
			
			<span class="c"># return organised data for output to slider		</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="n">m_out</span> <span class="o">+</span> <span class="s">&quot;= return_organised(&quot;</span> <span class="o">+</span> <span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot;_all);&quot;</span><span class="p">)</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="n">m_out</span> <span class="o">+</span> <span class="s">&quot;.var = &quot;</span> <span class="o">+</span> <span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot;_all(:,end)./1000;&quot;</span><span class="p">)</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="n">m_out</span> <span class="o">+</span> <span class="s">&quot;.ode = t./1000; </span><span class="si">% c</span><span class="s">onverted to seconds&quot;</span><span class="p">)</span> <span class="c">#,	#struct;&quot;,	</span>
		
		
		
		
		<span class="n">mwrite</span><span class="p">(</span><span class="n">mfio</span><span class="p">,</span><span class="s">&#39;end&#39;</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">close_file</span> <span class="p">(</span><span class="n">mfio</span><span class="p">)</span>
		
		<span class="bp">self</span><span class="o">.</span><span class="n">supp_input_ic</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">vectorised_to_readable</span><span class="p">()</span>	<span class="c"># return file to simplify for plotting</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">supp_initialise_data</span><span class="p">()</span>



</div>
	<span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>	
	<span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>	
	<span class="sd">&quot;&quot;&quot; SUPPLEMENTARY FUNCTION &quot;&quot;&quot;</span>	
	<span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>	
	<span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>	
<div class="viewcode-block" id="MatlabParser.supp_initialise_data"><a class="viewcode-back" href="../../eqparse.html#eqparse.matlabparser.MatlabParser.supp_initialise_data">[docs]</a>	<span class="k">def</span> <span class="nf">supp_initialise_data</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">mfile</span> <span class="o">=</span>  <span class="s">&quot;initialise_data&quot;</span>
		<span class="n">mfio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="n">mfile</span>
		<span class="n">mcomment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_comment</span>
		<span class="n">mwrite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span>
		<span class="c">#m_initial_ode = &quot;initial.ode&quot;</span>
		<span class="n">m_initial_param</span> <span class="o">=</span> <span class="s">&quot;init_param&quot;</span>
		<span class="n">m_print</span> <span class="o">=</span> <span class="s">&quot;p_store&quot;</span>
		<span class="n">m_noprint</span> <span class="o">=</span> <span class="s">&quot;p&quot;</span>
		<span class="n">m_ode</span> <span class="o">=</span> <span class="s">&quot;dydt&quot;</span>
		
		<span class="c"># open file</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">open_file</span> <span class="p">(</span><span class="n">mfio</span><span class="p">)</span>

		<span class="c"># initialise function</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;function [&quot;</span> <span class="o">+</span> <span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">m_noprint</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot;] = &quot;</span> <span class="o">+</span> <span class="n">mfile</span> <span class="o">+</span> <span class="s">&quot;(&quot;</span> <span class="o">+</span> <span class="n">m_initial_param</span> <span class="o">+</span> <span class="s">&quot;)</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>
											
		<span class="c"># user defined indexes</span>
		<span class="n">mIndex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;userdef&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">])</span>				<span class="c"># user defined ALL</span>
		<span class="n">mIndex_odeyes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_index</span><span class="p">(</span><span class="n">mIndex</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">])</span>	<span class="c"># user defined ODE</span>
		<span class="n">mIndex_odeno</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_index</span><span class="p">(</span><span class="n">mIndex</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;no&#39;</span><span class="p">])</span>		<span class="c"># user defined VAR</span>
		
		<span class="c"># user defined name list</span>
		<span class="n">p_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list</span> <span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">mIndex_odeyes</span><span class="p">:</span> <span class="n">p_list</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="n">m_initial_param</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span> <span class="o">+</span> <span class="n">p_list</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span>
		<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">mIndex_odeno</span><span class="p">:</span> <span class="n">p_list</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="n">m_initial_param</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span> <span class="o">+</span> <span class="n">p_list</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span>
		
		
		<span class="c"># preallocate storage</span>
		<span class="n">mI_user_no_ode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;print&#39;</span><span class="p">][</span><span class="s">&#39;no&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;no&#39;</span><span class="p">])</span>
		<span class="n">mI_uder_no_ode_but_print</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;print&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;no&#39;</span><span class="p">])</span>
		
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;if nargin&gt;0&quot;</span><span class="p">)</span>
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;preallocate storage for data&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="n">m_noprint</span> <span class="o">+</span> <span class="s">&quot; = zeros(1,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mI_user_no_ode</span><span class="p">))</span> <span class="o">+</span> <span class="s">&quot;);&quot;</span><span class="p">,</span>
						<span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot; = zeros(1,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mI_uder_no_ode_but_print</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;);&quot;</span><span class="p">,</span>
						<span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot; = zeros(1,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">]))</span> <span class="o">+</span><span class="s">&quot;);&quot;</span><span class="p">])</span>
		<span class="c"># search and replace initial values with new p_list</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">pattern_write</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="n">p_list</span><span class="p">,</span> <span class="s">&quot;comment&quot;</span><span class="p">],</span> <span class="p">[</span> <span class="s">&quot; &quot;</span><span class="p">,</span> <span class="s">&quot; = &quot;</span><span class="p">,</span> <span class="s">&quot;; % &quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_vec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;userdef&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">])</span>	
		<span class="c"># .. function dependent</span>
		<span class="n">mIndex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;userdef&#39;</span><span class="p">][</span><span class="s">&#39;no&#39;</span><span class="p">])</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">pattern_write</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="s">&quot;init-value&quot;</span><span class="p">,</span> <span class="s">&quot;comment&quot;</span><span class="p">],</span> <span class="p">[</span> <span class="s">&quot; &quot;</span><span class="p">,</span> <span class="s">&quot; = &quot;</span><span class="p">,</span> <span class="s">&quot;; % &quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_vec</span><span class="p">,</span> <span class="n">mIndex</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot;(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mI_uder_no_ode_but_print</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;) = 0;&quot;</span> <span class="p">])</span>
		
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;else</span><span class="se">\n</span><span class="si">% g</span><span class="s">et properties of parameters instead&quot;</span><span class="p">)</span>
		
		<span class="c"># if we want to return the initial condition, nargout = 1</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;if nargout == 1&quot;</span><span class="p">)</span>
		
		<span class="c">#mwrite (mfio, &quot;p = struct;&quot;)		</span>
		<span class="c"># user defined indexes</span>
		<span class="n">mIndex_yes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;userdef&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">])</span>				<span class="c"># user defined ALL</span>
		<span class="n">mIndex_odeyes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_index</span><span class="p">(</span><span class="n">mIndex_yes</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">])</span>	<span class="c"># user defined ODE</span>
		<span class="n">mIndex_odeno</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_index</span><span class="p">(</span><span class="n">mIndex_yes</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;no&#39;</span><span class="p">])</span>		<span class="c"># user defined VAR</span>
		
		<span class="c"># user defined name list</span>
		<span class="n">p_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list</span> <span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">mIndex_odeyes</span><span class="p">:</span> <span class="n">p_list</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="n">m_initial_param</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span> <span class="o">+</span> <span class="n">p_list</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span>
		<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">mIndex_odeno</span><span class="p">:</span> <span class="n">p_list</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="n">m_initial_param</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span> <span class="o">+</span> <span class="n">p_list</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span>
		
		<span class="c"># search and replace initial values with new p_list</span>
		<span class="n">p_rhs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_and_replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_list</span> <span class="p">(</span><span class="s">&#39;init-value&#39;</span><span class="p">),</span> <span class="n">p_list</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">pattern_write</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="n">p_list</span><span class="p">,</span><span class="n">p_rhs</span><span class="p">],</span> <span class="p">[</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot; = &quot;</span><span class="p">,</span> <span class="s">&quot;;&quot;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">mIndex_yes</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot; = &quot;</span> <span class="o">+</span> <span class="n">m_initial_param</span> <span class="o">+</span> <span class="s">&quot;;&quot;</span><span class="p">)</span>		

		
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;else&quot;</span><span class="p">)</span>
		<span class="c"># add parameter properties to data (as p_store)</span>
		<span class="n">iter_only</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;\((.*)\)&#39;</span><span class="p">,</span> <span class="n">elem</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_vec</span><span class="p">]</span>
		<span class="n">type_only</span> <span class="o">=</span> <span class="p">[</span><span class="n">elem</span><span class="p">[:</span><span class="n">elem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;(&#39;</span><span class="p">)]</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="p">[</span><span class="n">elem</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_vec</span><span class="p">]]</span>		
		<span class="c"># print the name_only</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot; = {&quot;</span> <span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iter_only</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;&#39;&quot;</span> <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;&#39;};</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>
		<span class="c"># print the type_only (as p)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="n">m_noprint</span> <span class="o">+</span> <span class="s">&quot; = {&quot;</span> <span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iter_only</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="n">type_only</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;&#39;&quot;</span>  <span class="o">+</span> <span class="s">&quot;,&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="n">type_only</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;&#39;};</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>
		<span class="c"># print the iter_only (as dydt)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot; = [&quot;</span> <span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iter_only</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="n">iter_only</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="n">iter_only</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;];</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
		
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;end&quot;</span><span class="p">)</span>		
				
				
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;end&quot;</span><span class="p">)</span>										
		
		<span class="c"># close file</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">close_file</span> <span class="p">(</span><span class="n">mfio</span><span class="p">)</span>

</div>
	<span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>	
	<span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>	
	<span class="sd">&quot;&quot;&quot; SUPPLEMENTARY FUNCTION &quot;&quot;&quot;</span>	
	<span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>	
	<span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>	
<div class="viewcode-block" id="MatlabParser.supp_input_ic"><a class="viewcode-back" href="../../eqparse.html#eqparse.matlabparser.MatlabParser.supp_input_ic">[docs]</a>	<span class="k">def</span> <span class="nf">supp_input_ic</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">mfile</span> <span class="o">=</span>  <span class="s">&quot;get_ic&quot;</span>
		<span class="n">mfio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="n">mfile</span>
		<span class="n">mcomment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_comment</span>
		<span class="n">mwrite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span>
		<span class="n">m_initial_ode</span> <span class="o">=</span> <span class="s">&quot;ode&quot;</span>
		<span class="n">m_initial_param</span> <span class="o">=</span> <span class="s">&quot;initparam&quot;</span>

		<span class="c"># open file</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">open_file</span> <span class="p">(</span><span class="n">mfio</span><span class="p">)</span>

		<span class="c"># initialise function</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;function &quot;</span> <span class="o">+</span> <span class="n">m_initial_param</span> <span class="o">+</span> <span class="s">&quot; = &quot;</span> <span class="o">+</span> <span class="n">mfile</span> <span class="o">+</span> <span class="s">&quot;()</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>
											
		<span class="c"># user defined indexes</span>
		<span class="n">mIndex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;userdef&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">])</span>				<span class="c"># user defined ALL</span>
		<span class="n">mIndex_odeyes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_index</span><span class="p">(</span><span class="n">mIndex</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">])</span>	<span class="c"># user defined ODE</span>
		<span class="n">mIndex_odeno</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_index</span><span class="p">(</span><span class="n">mIndex</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;no&#39;</span><span class="p">])</span>		<span class="c"># user defined VAR</span>
		
		<span class="c"># user defined name list</span>
		<span class="n">p_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list</span> <span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">mIndex_odeyes</span><span class="p">:</span> <span class="n">p_list</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="n">m_initial_param</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span> <span class="o">+</span> <span class="n">p_list</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span>
		<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">mIndex_odeno</span><span class="p">:</span> <span class="n">p_list</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="n">m_initial_param</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span> <span class="o">+</span> <span class="n">p_list</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span>
		
		<span class="c"># search and replace initial values with new p_list</span>
		<span class="n">p_rhs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_and_replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_list</span> <span class="p">(</span><span class="s">&#39;init-value&#39;</span><span class="p">),</span> <span class="n">p_list</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">pattern_write</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="n">p_list</span><span class="p">,</span><span class="n">p_rhs</span><span class="p">],</span> <span class="p">[</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot; = &quot;</span><span class="p">,</span> <span class="s">&quot;;&quot;</span><span class="p">],</span> 
									<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">mIndex</span><span class="p">)</span>
										
		<span class="c"># close file</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">close_file</span> <span class="p">(</span><span class="n">mfio</span><span class="p">)</span>
		
		
		
				

</div>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	&quot;vectorised_to_readable&quot;</span>
<span class="sd">	</span>
<span class="sd">	&quot;&quot;&quot;</span>
<div class="viewcode-block" id="MatlabParser.vectorised_to_readable"><a class="viewcode-back" href="../../eqparse.html#eqparse.matlabparser.MatlabParser.vectorised_to_readable">[docs]</a>	<span class="k">def</span> <span class="nf">vectorised_to_readable</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

		<span class="c">#mfile = &quot;run&quot; + file_ext</span>
		<span class="n">mfile</span> <span class="o">=</span>  <span class="s">&quot;return_organised&quot;</span>
		<span class="n">mfio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="n">mfile</span>
		<span class="n">mcomment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_comment</span>
		<span class="n">mwrite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span>
		<span class="n">m_print</span> <span class="o">=</span> <span class="s">&quot;p_store&quot;</span>	<span class="c"># VC_NAME_PRINT</span>
		<span class="n">m_noprint</span> <span class="o">=</span> <span class="s">&quot;p&quot;</span>	<span class="c"># VEC_NAME</span>
		<span class="n">m_ode</span> <span class="o">=</span> <span class="s">&quot;dydt&quot;</span>	<span class="c"># ode var ODE_NAME</span>
		<span class="n">m_out</span> <span class="o">=</span> <span class="s">&quot;out&quot;</span>
		<span class="n">m_otime</span><span class="o">=</span> <span class="s">&#39;out_time&#39;</span>
		<span class="n">t_end</span> <span class="o">=</span> <span class="s">&quot;t_end&quot;</span>
		<span class="n">set_p</span> <span class="o">=</span> <span class="s">&quot;set_params&quot;</span>
		<span class="n">ode_method</span> <span class="o">=</span> <span class="s">&quot;ode15s&quot;</span>
		<span class="n">m_ode_fname</span> <span class="o">=</span> <span class="s">&quot;ode&quot;</span>
		<span class="n">m_add_events</span> <span class="o">=</span> <span class="s">&quot;passEvents&quot;</span>
		<span class="n">m_struct</span> <span class="o">=</span> <span class="s">&quot;options&quot;</span>



		<span class="c"># open file</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">open_file</span> <span class="p">(</span><span class="n">mfio</span><span class="p">)</span>
		
		<span class="c"># set function</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;function &quot;</span> <span class="o">+</span> <span class="n">m_out</span> <span class="o">+</span> <span class="s">&quot; = &quot;</span> <span class="o">+</span> <span class="n">mfile</span> <span class="o">+</span> <span class="s">&quot; (&quot;</span> \
							<span class="o">+</span> <span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot;)</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>

		
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="n">m_out</span> <span class="o">+</span> <span class="s">&quot;= struct;&quot;</span><span class="p">])</span>
		
		<span class="n">lhs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list</span> <span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_vec</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>	<span class="c"># get a column form dict list</span>
		<span class="n">num_iter</span> <span class="o">=</span> <span class="p">[</span><span class="nb">filter</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">isdigit</span><span class="p">,</span> <span class="n">elem</span><span class="p">)</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">lhs</span><span class="p">]</span>		<span class="c"># get number from derived list</span>
		<span class="n">sto_iter</span> <span class="o">=</span> <span class="p">[</span><span class="n">elem</span><span class="p">[:</span><span class="n">elem</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;(&#39;</span><span class="p">)]</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">lhs</span><span class="p">]</span>		<span class="c"># get the name of storage for each</span>
		
		
		
		<span class="n">index_ode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;print&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">])</span>		
		<span class="bp">self</span><span class="o">.</span><span class="n">pattern_write</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="n">sto_iter</span><span class="p">,</span> <span class="n">num_iter</span><span class="p">],</span> <span class="p">[</span> <span class="n">m_out</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span><span class="p">,</span> <span class="s">&quot; = &quot;</span><span class="p">,</span> <span class="s">&quot;(:,&quot;</span><span class="p">,</span><span class="s">&quot;);&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">index_ode</span><span class="p">)</span>
		<span class="c">#mwrite (mfio, m_out + &quot;.ode.(&#39;t&#39;) = t./1000;&quot;, &quot;\n\n&quot;)</span>
		
				
		<span class="n">index_var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;no&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;print&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">])</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">pattern_write</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="n">sto_iter</span><span class="p">,</span> <span class="n">num_iter</span><span class="p">],</span> <span class="p">[</span> <span class="n">m_out</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span><span class="p">,</span> <span class="s">&quot; = &quot;</span><span class="p">,</span> <span class="s">&quot;(:,&quot;</span><span class="p">,</span><span class="s">&quot;);&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">index_var</span><span class="p">)</span>		
		<span class="c">#mwrite (mfio, m_out + &quot;.var.(&#39;t&#39;) = &quot; + m_print + &quot;(:,end)./1000;&quot;, &quot;\n\n&quot;)</span>
		
		<span class="n">mwrite</span><span class="p">(</span><span class="n">mfio</span><span class="p">,</span><span class="s">&#39;end&#39;</span><span class="p">)</span>
		
		<span class="c"># close file</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">close_file</span> <span class="p">(</span><span class="n">mfio</span><span class="p">)</span>
		
		
		
		
		
		
		
		</div>
	<span class="sd">&quot;&quot;&quot;			</span>
<span class="sd">	CREATE FSA_cvodes MATLAB FILE</span>
<span class="sd">	contains the actual set-up and organisation of cell system</span>
<span class="sd">	in a structured order, is also main file</span>
<span class="sd">	&quot;&quot;&quot;</span>
<div class="viewcode-block" id="MatlabParser.FSA_cvodes"><a class="viewcode-back" href="../../eqparse.html#eqparse.matlabparser.MatlabParser.FSA_cvodes">[docs]</a>	<span class="k">def</span> <span class="nf">FSA_cvodes</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

		<span class="n">mfile</span> <span class="o">=</span>  <span class="s">&quot;FSA_cvodes&quot;</span>
		<span class="n">mfio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="n">mfile</span>
		<span class="n">mcomment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_comment</span>
		<span class="n">mwrite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span>
		<span class="n">m_time</span> <span class="o">=</span> <span class="s">&quot;t&quot;</span>
		<span class="n">m_time_temp</span> <span class="o">=</span> <span class="s">&quot;t_temp&quot;</span>
		<span class="n">m_dtout</span> <span class="o">=</span> <span class="s">&quot;20&quot;</span> <span class="c"># 5 ms default</span>
		<span class="n">m_ode</span> <span class="o">=</span> <span class="s">&quot;dydt&quot;</span>
		<span class="n">m_ode_temp</span> <span class="o">=</span> <span class="s">&quot;dydt_temp&quot;</span>
		<span class="n">m_outsens</span> <span class="o">=</span> <span class="s">&quot;yS&quot;</span>
		<span class="n">m_outsens_temp</span> <span class="o">=</span> <span class="s">&quot;yS_temp&quot;</span>
		<span class="n">m_sens_names</span> <span class="o">=</span> <span class="s">&quot;pS&quot;</span>
		<span class="n">m_data</span> <span class="o">=</span> <span class="s">&quot;pdata&quot;</span>
		<span class="n">m_print</span> <span class="o">=</span> <span class="s">&quot;p_store&quot;</span>	<span class="c"># VC_NAME_PRINT</span>
		<span class="n">m_noprint</span> <span class="o">=</span> <span class="s">&quot;p&quot;</span>	<span class="c"># VEC_NAME</span>
		<span class="c">#m_ode = &quot;dydt&quot;	# ode var ODE_NAME</span>
		<span class="c">#m_out = &quot;out&quot;</span>
		<span class="c">#m_otime= &#39;out_time&#39;</span>
		<span class="n">t_end</span> <span class="o">=</span> <span class="s">&quot;t_end&quot;</span>
		<span class="n">set_p</span> <span class="o">=</span> <span class="s">&quot;initial&quot;</span>
		<span class="c">#ode_method = &quot;ode15s&quot;</span>
		<span class="c">#m_ode_fname = &quot;ode&quot;</span>
		<span class="n">m_add_events</span> <span class="o">=</span> <span class="s">&quot;passEvents&quot;</span>
		<span class="n">m_struct</span> <span class="o">=</span> <span class="s">&quot;options&quot;</span>
		<span class="n">f_jacobian</span> <span class="o">=</span> <span class="s">&quot;djacfn&quot;</span>
		<span class="n">f_ode</span> <span class="o">=</span> <span class="s">&quot;FSA_ode&quot;</span>
					
		<span class="c"># open file</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">open_file</span> <span class="p">(</span><span class="n">mfio</span><span class="p">)</span>
		
		<span class="c"># define header</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;function [&quot;</span> <span class="o">+</span>  <span class="n">m_time</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot;_out,&quot;</span> <span class="o">+</span> <span class="n">m_outsens</span> <span class="o">+</span> <span class="s">&quot;_out,&quot;</span> <span class="o">+</span> <span class="n">set_p</span> <span class="o">+</span> <span class="s">&quot;] = &quot;</span> \
					<span class="o">+</span> <span class="n">mfile</span> <span class="o">+</span>  <span class="s">&quot; (&quot;</span> <span class="o">+</span> <span class="n">set_p</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">m_sens_names</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">m_add_events</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">m_struct</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span><span class="p">)</span>
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;note: This function does not store the variables p_store&quot;</span><span class="p">)</span>
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;which is used in run_slider example for extracting temporal&quot;</span><span class="p">)</span>
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;activity of stored functions&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>
							
		<span class="c"># user data</span>
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;define the initial parameters for both parameters and ODE&quot;</span><span class="p">)</span>
		
		<span class="c"># persistent variables</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;persistent name_only type_only iter_only&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>
		<span class="c">#</span>
		<span class="c"># NOTE: this is the extra commands for slider version of run</span>
		<span class="c">#</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span><span class="s">&quot;if nargout==4&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span><span class="n">m_time</span> <span class="o">+</span> <span class="s">&quot; = {}; &quot;</span> <span class="o">+</span> <span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot;_out = {}; &quot;</span> <span class="o">+</span> <span class="n">m_outsens</span> <span class="o">+</span> <span class="s">&quot;_out = {}; &quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>	
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span><span class="n">set_p</span> <span class="o">+</span> <span class="s">&quot;.param = [];&quot;</span><span class="p">)</span>		
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span><span class="n">set_p</span> <span class="o">+</span> <span class="s">&quot;.ode = [];&quot;</span><span class="p">)</span>		
	
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;initialize the original parameter output&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,)</span>
	
		<span class="n">mIndex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;userdef&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">])</span> 	
		<span class="n">mIndex_odeyes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;userdef&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">])</span>
		<span class="n">mIndex_odeno</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;userdef&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;no&#39;</span><span class="p">])</span>
		
		<span class="c">#p_list = self.get_list (&#39;name&#39;, self.data, set_p + &quot;.&quot;,&quot;&quot;)</span>
		<span class="n">p_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list</span> <span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">mIndex_odeyes</span><span class="p">:</span>
			<span class="n">p_list</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="n">set_p</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span> <span class="o">+</span> <span class="n">p_list</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span>
		<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">mIndex_odeno</span><span class="p">:</span>
			<span class="n">p_list</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="n">set_p</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span> <span class="o">+</span> <span class="n">p_list</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span>
		<span class="n">p_rhs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_and_replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_list</span> <span class="p">(</span><span class="s">&#39;init-value&#39;</span><span class="p">),</span> <span class="n">p_list</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">pattern_write</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="n">p_list</span><span class="p">,</span><span class="n">p_rhs</span><span class="p">],</span> <span class="p">[</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot; = &quot;</span><span class="p">,</span> <span class="s">&quot;;&quot;</span><span class="p">],</span> 
									<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">mIndex</span><span class="p">)</span>
									
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;else&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>

		<span class="c"># preallocate storage</span>
		<span class="n">mI_user_no_ode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;print&#39;</span><span class="p">][</span><span class="s">&#39;no&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;no&#39;</span><span class="p">])</span>
		<span class="n">mI_uder_no_ode_but_print</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;print&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;no&#39;</span><span class="p">])</span>
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;preallocate storage for data&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="n">m_noprint</span> <span class="o">+</span> <span class="s">&quot; = zeros(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mI_user_no_ode</span><span class="p">))</span> <span class="o">+</span> <span class="s">&quot;,1);&quot;</span><span class="p">,</span>
						<span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot; = zeros(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mI_uder_no_ode_but_print</span><span class="p">))</span> <span class="o">+</span> <span class="s">&quot;,1);&quot;</span><span class="p">,</span>
						<span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot; = zeros(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">]))</span> <span class="o">+</span> <span class="s">&quot;,1);&quot;</span><span class="p">])</span>
		
		<span class="c">####### redefine RHS</span>
		<span class="c"># order concateq_unordered according to self.order.init_value</span>
		<span class="c">#concateq = []</span>
		<span class="c">#for elem in self.index[&#39;order&#39;][&#39;init-value&#39;]:</span>
		<span class="c">#	if self.names[elem] in concateq_unordered:</span>
		<span class="c">#		concateq.append(self.names[elem])</span>
		<span class="c">#print concateq</span>
		<span class="n">concateq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_names_restricted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">,</span> <span class="n">mI_uder_no_ode_but_print</span><span class="p">)</span>
		<span class="n">concat_index</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">concateq</span><span class="p">]</span>
		<span class="c">#a = self.get_list(&#39;rhs&#39;) #[x[&#39;rhs&#39;] for x in self.data]</span>
		<span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list</span> <span class="p">(</span><span class="s">&quot;rhs&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">concat_index</span><span class="p">)</span>
		<span class="c">#for elem in concat_index:</span>
		<span class="c">#	a[elem] = &#39;&#39;</span>
		<span class="c">#print a</span>
			
 		<span class="c">#concateq_rhs_sub = []</span>
 		<span class="c">#for elem in concateq:</span>
 		<span class="c">#	concateq_rhs_sub.append(&#39;(&#39; + self.data[self.names.index(elem)][&#39;rhs&#39;] + &#39;)&#39;)</span>
		<span class="n">concateq_rhs_sub</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;(&#39;</span> <span class="o">+</span> <span class="n">elem</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">a</span><span class="p">]</span>
		<span class="c">#print concateq_rhs_sub</span>
		<span class="c">######## this is not finished</span>



		<span class="bp">self</span><span class="o">.</span><span class="n">pattern_write</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="n">p_list</span><span class="p">,</span> <span class="s">&quot;comment&quot;</span><span class="p">],</span> <span class="p">[</span> <span class="s">&quot; &quot;</span><span class="p">,</span> <span class="s">&quot; = &quot;</span><span class="p">,</span> <span class="s">&quot;; % &quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_vec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;userdef&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">])</span>	
		<span class="c"># .. function dependent</span>
		<span class="n">mIndex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;userdef&#39;</span><span class="p">][</span><span class="s">&#39;no&#39;</span><span class="p">])</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">pattern_write</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="s">&quot;init-value&quot;</span><span class="p">,</span> <span class="s">&quot;comment&quot;</span><span class="p">],</span> <span class="p">[</span> <span class="s">&quot; &quot;</span><span class="p">,</span> <span class="s">&quot; = &quot;</span><span class="p">,</span> <span class="s">&quot;; % &quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_vec</span><span class="p">,</span> <span class="n">mIndex</span><span class="p">)</span>
		<span class="c"># this is the time output</span>
		<span class="c">#mwrite (mfio, [m_print + &quot;(&quot; + str(len(mI_uder_no_ode_but_print) + 1) + &quot;) = 0;&quot; ])</span>

		<span class="n">iter_only</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;\((.*)\)&#39;</span><span class="p">,</span> <span class="n">elem</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_vec</span><span class="p">]</span>
		<span class="n">type_only</span> <span class="o">=</span> <span class="p">[</span><span class="n">elem</span><span class="p">[:</span><span class="n">elem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;(&#39;</span><span class="p">)]</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="p">[</span><span class="n">elem</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_vec</span><span class="p">]]</span>		
		<span class="c"># print the names</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">if isempty(name_only)</span><span class="se">\n\t</span><span class="s">name_only = {&quot;</span> <span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iter_only</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;&#39;&quot;</span> <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;&#39;};</span><span class="se">\n</span><span class="s">end&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>
		<span class="c"># print the types</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">if isempty(type_only)</span><span class="se">\n\t</span><span class="s">type_only = {&quot;</span> <span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iter_only</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="n">type_only</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;&#39;&quot;</span>  <span class="o">+</span> <span class="s">&quot;,&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="n">type_only</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;&#39;};</span><span class="se">\n</span><span class="s">end&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>
		<span class="c"># print the iters</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">if isempty(iter_only)</span><span class="se">\n\t</span><span class="s">iter_only = [&quot;</span> <span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iter_only</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="n">iter_only</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="n">iter_only</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;];</span><span class="se">\n</span><span class="s">end&quot;</span><span class="p">)</span>
		
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="n">t_end</span> <span class="o">+</span> <span class="s">&quot; = &quot;</span> <span class="o">+</span> <span class="n">set_p</span> <span class="o">+</span> <span class="s">&quot;.param.&quot;</span> <span class="o">+</span> <span class="n">t_end</span> <span class="o">+</span> <span class="s">&quot;;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">])</span>
		
		
		<span class="c"># Check if chosen variables (::m_sens_names)</span>
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;check if chosen sensitive variables exist&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;for iname = 1:length(&quot;</span> <span class="o">+</span> <span class="n">m_sens_names</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span><span class="p">,</span>
						<span class="s">&quot;</span><span class="se">\t</span><span class="s">if isempty(strmatch(&quot;</span> <span class="o">+</span> <span class="n">m_sens_names</span> <span class="o">+</span> <span class="s">&quot;(iname), name_only,&#39;exact&#39;))&quot;</span><span class="p">,</span>
						<span class="s">&quot;</span><span class="se">\t\t</span><span class="s">error([&#39;The sensitivity variable &#39; &quot;</span> <span class="o">+</span> <span class="n">m_sens_names</span> <span class="o">+</span> <span class="s">&quot;(iname), &#39; does not exist&#39;])&quot;</span><span class="p">,</span>
						<span class="s">&quot;</span><span class="se">\t</span><span class="s">end&quot;</span><span class="p">,</span>
						<span class="s">&quot;end&quot;</span><span class="p">])</span> 
			
						
		<span class="c">#m_ode = &quot;dydt&quot;</span>
		<span class="c">#m_ode_new = &quot;dydt_coll&quot;</span>
		<span class="c">#m_outsens = &quot;yS&quot;</span>
		<span class="c">#m_outsens_new = &quot;yS_coll&quot;</span>
		<span class="c">#m_outsens_init = &quot;yS0&quot;</span>
		<span class="c">#m_sens_names = &quot;pS&quot;</span>
		<span class="c">#m_data = &quot;pdata&quot;</span>
		
					 			
		<span class="c"># add events (m_add_events is passEvents)</span>
		<span class="n">m_size_add_events</span> <span class="o">=</span> <span class="s">&quot;size_&quot;</span> <span class="o">+</span> <span class="n">m_add_events</span>
		<span class="n">m_add_events_vec</span> <span class="o">=</span> <span class="s">&quot;time_vec&quot;</span>
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;set up static events module if not defined&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;if nargin==2</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span> \
				<span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">m_add_events</span> <span class="o">+</span> <span class="s">&quot;.time = []; % time point step all &lt; t_end [vector]</span><span class="se">\n</span><span class="s">&quot;</span> \
				<span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">m_add_events</span> <span class="o">+</span> <span class="s">&quot;.change = {[]}; </span><span class="si">% c</span><span class="s">hanges to parameter values [vector]</span><span class="se">\n</span><span class="s">&quot;</span> \
				<span class="s">&quot;elseif nargin==3</span><span class="se">\n</span><span class="s">&quot;</span> \
				<span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">m_add_events</span> <span class="o">+</span> <span class="s">&quot;.change = {[],&quot;</span> <span class="o">+</span> <span class="n">m_add_events</span> <span class="o">+</span> <span class="s">&quot;.change{:}};</span><span class="se">\n</span><span class="s">&quot;</span> \
				<span class="s">&quot;end</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>

		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;Time vector when changes are made (x1000 convert to ms form s)&quot;</span><span class="p">)</span>				
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="n">m_add_events_vec</span> <span class="o">+</span> <span class="s">&quot; = [0,&quot;</span> <span class="o">+</span> <span class="n">m_add_events</span> <span class="o">+</span> <span class="s">&quot;.time,&quot;</span> <span class="o">+</span> <span class="n">t_end</span> <span class="o">+</span> <span class="s">&quot;].*1000;&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;Ns = length(&quot;</span> <span class="o">+</span> <span class="n">m_sens_names</span> <span class="o">+</span> <span class="s">&quot;);&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;def_ParamList = zeros(size(&quot;</span> <span class="o">+</span> <span class="n">m_sens_names</span> <span class="o">+</span> <span class="s">&quot;));&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;def_ParamScales = def_ParamList;&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;for elem = 1:length(&quot;</span> <span class="o">+</span> <span class="n">m_sens_names</span> <span class="o">+</span> <span class="s">&quot;)</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span>
						<span class="s">&quot;</span><span class="se">\t</span><span class="s"> def_ParamList(elem) = &quot;</span> <span class="o">+</span> <span class="s">&quot;iter_only(strmatch(&quot;</span> <span class="o">+</span> <span class="n">m_sens_names</span> <span class="o">+</span> <span class="s">&quot;(elem), name_only, &#39;exact&#39;));</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span>
						<span class="s">&quot;</span><span class="se">\t</span><span class="s"> def_ParamScales(elem) = &quot;</span> <span class="o">+</span> <span class="n">m_noprint</span> <span class="o">+</span> <span class="s">&quot;(def_ParamList(elem));</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span>
						<span class="s">&quot;end&quot;</span><span class="p">)</span>
		
		<span class="c">#pS_index = </span>
		<span class="c">#mwrite (mfio, m_ode + &quot; = &quot; + m_ode + &quot;;&quot;)		</span>
		<span class="c">#mwrite (mfio, m_time + &quot; = &quot; + m_time + &quot;;&quot;)	</span>
			
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;inital data&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="n">m_outsens</span> <span class="o">+</span> <span class="s">&quot; = zeros(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">]))</span> <span class="o">+</span> <span class="s">&quot;,Ns);&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="n">m_time</span> <span class="o">+</span> <span class="s">&quot; = 0.0;&quot;</span><span class="p">)</span>  				
		
		<span class="c"># start ode</span>
		<span class="c">#m_print_out = m_print + &quot;_all&quot;</span>
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;solve ode set through event set&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;for i=1:numel(&quot;</span> <span class="o">+</span> <span class="n">m_add_events_vec</span> <span class="o">+</span> <span class="s">&quot;)-1</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>

		<span class="c">######</span>
		<span class="c"># FOR LOOP STARTS</span>
		<span class="c">######</span>
		
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;change parameter set&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n\t</span><span class="s">&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">CHANGICALS = &quot;</span> <span class="o">+</span> <span class="n">m_add_events</span> <span class="o">+</span> <span class="s">&quot;.change{i};</span><span class="se">\n</span><span class="s">&quot;</span> \
					<span class="s">&quot;    for j=1:numel(CHANGICALS)</span><span class="se">\n</span><span class="s">&quot;</span> \
					<span class="s">&quot;        niter = strmatch(CHANGICALS{j}{1},name_only,&#39;exact&#39;);</span><span class="se">\n</span><span class="s">&quot;</span> \
					<span class="s">&quot;        switch type_only{niter}</span><span class="se">\n</span><span class="s">&quot;</span> \
					<span class="s">&quot;            case &#39;&quot;</span> <span class="o">+</span> <span class="n">m_noprint</span> <span class="o">+</span> <span class="s">&quot;&#39;</span><span class="se">\n</span><span class="s">&quot;</span> \
					<span class="s">&quot;                &quot;</span> <span class="o">+</span> <span class="n">m_noprint</span> <span class="o">+</span> <span class="s">&quot;(iter_only(niter)) = CHANGICALS{j}{2};</span><span class="se">\n</span><span class="s">&quot;</span> 
					<span class="s">&quot;            case &#39;&quot;</span> <span class="o">+</span> <span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot;&#39;</span><span class="se">\n</span><span class="s">&quot;</span> \
					<span class="s">&quot;                &quot;</span> <span class="o">+</span> <span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot;(end,iter_only(niter)) = CHANGICALS{j}{2};</span><span class="se">\n</span><span class="s">&quot;</span> 
					<span class="s">&quot;            case &#39;&quot;</span> <span class="o">+</span> <span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot;&#39;</span><span class="se">\n</span><span class="s">&quot;</span> \
					<span class="s">&quot;                &quot;</span> <span class="o">+</span> <span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot;(end,iter_only(niter)) = CHANGICALS{j}{2};</span><span class="se">\n</span><span class="s">&quot;</span> 
					<span class="s">&quot;        end</span><span class="se">\n</span><span class="s">&quot;</span> \
					<span class="s">&quot;    end</span><span class="se">\n</span><span class="s">&quot;</span> \
					<span class="p">,</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>
		
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;User data structure&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="n">m_data</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span> <span class="o">+</span> <span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot; = &quot;</span> <span class="o">+</span> <span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot;;&quot;</span><span class="p">,</span>
						<span class="n">m_data</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span> <span class="o">+</span> <span class="n">m_noprint</span> <span class="o">+</span> <span class="s">&quot; = &quot;</span> <span class="o">+</span> <span class="n">m_noprint</span> <span class="o">+</span> <span class="s">&quot;;&quot;</span><span class="p">])</span>
			
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;CVODE initialisation!&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;options_cvode = CVodeSetOptions(&#39;UserData&#39;,&quot;</span> <span class="o">+</span> <span class="n">m_data</span> <span class="o">+</span> <span class="s">&quot;,...</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span>
						<span class="s">&quot;</span><span class="se">\t\t</span><span class="s">&#39;RelTol&#39;&quot;</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="s">&quot;1.0e-4&quot;</span> <span class="o">+</span> <span class="s">&quot;,...</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span>
						<span class="s">&quot;</span><span class="se">\t\t</span><span class="s">&#39;AbsTol&#39;&quot;</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="s">&quot;ones(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">])),</span><span class="s">&quot;,1).*1e-12&quot;</span> <span class="o">+</span> <span class="s">&quot;,...</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span>
						<span class="s">&quot;</span><span class="se">\t\t</span><span class="s">&#39;JacobianFn&#39;,&quot;</span> <span class="o">+</span> <span class="s">&quot;@&quot;</span> <span class="o">+</span> <span class="n">f_jacobian</span> <span class="o">+</span>
						<span class="s">&quot;);&quot;</span><span class="p">)</span>
		
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;Moniter output for order etc (use with option?)&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>	
			
			
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;initialise cvode now...&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>	
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;CVodeInit(@&quot;</span> <span class="o">+</span> <span class="n">f_ode</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="s">&quot;&#39;BDF&#39;, &#39;Newton&#39;,&quot;</span> <span class="o">+</span> <span class="n">m_time</span> <span class="o">+</span> <span class="s">&quot;(end), &quot;</span>
						 <span class="o">+</span> <span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot;(:,end), options_cvode);&quot;</span><span class="p">)</span>
						

		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;FSA initialisation options...&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>	
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;FSAoptions = CVodeSensSetOptions(&#39;method&#39;,&#39;Simultaneous&#39;,...</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span>
						<span class="s">&quot;</span><span class="se">\t\t</span><span class="s">&#39;ErrControl&#39;&quot;</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="s">&quot;true&quot;</span> <span class="o">+</span> <span class="s">&quot;,...</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span>
						<span class="s">&quot;</span><span class="se">\t\t</span><span class="s">&#39;ParamField&#39;&quot;</span> <span class="o">+</span> <span class="s">&quot;,&#39;&quot;</span> <span class="o">+</span> <span class="n">m_noprint</span> <span class="o">+</span> <span class="s">&quot;&#39;,...</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span>
						<span class="s">&quot;</span><span class="se">\t\t</span><span class="s">&#39;ParamList&#39;&quot;</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="s">&quot;def_ParamList&quot;</span> <span class="o">+</span> <span class="s">&quot;,...</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span>
						<span class="s">&quot;</span><span class="se">\t\t</span><span class="s">&#39;ParamScales&#39;&quot;</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="s">&quot;def_ParamScales&quot;</span> <span class="o">+</span> <span class="s">&quot;...</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span>
						<span class="s">&quot;</span><span class="se">\t</span><span class="s">);&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;CVodeSensInit(Ns, [], &quot;</span> <span class="o">+</span> <span class="n">m_outsens</span> <span class="o">+</span> <span class="s">&quot;(:,:,end), FSAoptions);</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
				


	
		<span class="c"># do the noval FSA analysis</span>
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;FSA return and ODE cvodes solve will be done here&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n\t</span><span class="s">&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="n">m_time_temp</span> <span class="o">+</span> <span class="s">&quot; = &quot;</span> <span class="o">+</span> <span class="s">&quot;[&quot;</span> <span class="o">+</span> <span class="n">m_add_events_vec</span> <span class="o">+</span> <span class="s">&quot;(i)&quot;</span> <span class="o">+</span> <span class="s">&quot;+&quot;</span> <span class="o">+</span> <span class="n">m_dtout</span> <span class="o">+</span> <span class="s">&quot;:&quot;</span> <span class="o">+</span> <span class="n">m_dtout</span> <span class="o">+</span> <span class="s">&quot;:&quot;</span> <span class="o">+</span>  <span class="n">m_add_events_vec</span> <span class="o">+</span> <span class="s">&quot;(i+1)];&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;[status, ~,&quot;</span> <span class="o">+</span> <span class="n">m_ode_temp</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span> <span class="o">+</span> <span class="n">m_outsens_temp</span> <span class="o">+</span> <span class="s">&quot;]&quot;</span> <span class="o">+</span>
					  <span class="s">&quot; = CVode (&quot;</span> <span class="o">+</span> <span class="n">m_time_temp</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span> <span class="o">+</span> <span class="s">&quot;&#39;Normal&#39;);&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;if status==1 </span><span class="si">% e</span><span class="s">rror occured during cvodes simulaiton progression&quot;</span><span class="p">,</span>
						<span class="s">&quot;</span><span class="se">\t</span><span class="s">error(&#39;error in parsed FSA file&#39;)&quot;</span><span class="p">,</span>
						<span class="s">&quot;end&quot;</span><span class="p">])</span>
		<span class="c"># m_time : total time vector as arg out</span>
		<span class="c"># m</span>
		<span class="c">#m_time_temp</span>
		<span class="c"># m_add_events_vec</span>
		
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;update variables&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="n">m_time</span> <span class="o">+</span> <span class="s">&quot; = [&quot;</span> <span class="o">+</span> <span class="n">m_time</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">m_time_temp</span> <span class="o">+</span> <span class="s">&quot;];&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot; = cat(2,&quot;</span> <span class="o">+</span> <span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">m_ode_temp</span> <span class="o">+</span> <span class="s">&quot;);&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="n">m_outsens</span> <span class="o">+</span> <span class="s">&quot; = cat(3,&quot;</span> <span class="o">+</span> <span class="n">m_outsens</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">m_outsens_temp</span> <span class="o">+</span> <span class="s">&quot;);&quot;</span><span class="p">)</span>

		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;recover param and function values&quot;</span><span class="p">)</span>
		<span class="c">#mwrite (mfio, &quot;[~, ~, ~, &quot; + m_print + &quot;, &quot; + m_noprint + &quot;] = &quot; \</span>
		<span class="c">#			+ f_ode + &quot;(&quot; + m_time + &quot;,&quot; + m_ode + &quot;(1,:), &quot; + m_data + &quot;);&quot;)</span>
		
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;end </span><span class="si">% e</span><span class="s">nd of events for loop&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>
			
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;si = CVodeGetStats;&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;CVodeFree;&quot;</span><span class="p">)</span>		
		
		
				
		<span class="c"># change variables for output</span>
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;rewrite variables for easy output&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="n">m_outsens</span> <span class="o">+</span> <span class="s">&quot;_out = struct;&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot;_out = struct;&quot;</span><span class="p">)</span>
		<span class="n">ode_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_names_restricted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">])</span>
		<span class="p">[</span><span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="n">m_outsens</span> <span class="o">+</span> <span class="s">&quot;_out.&quot;</span> <span class="o">+</span> <span class="n">elem</span> <span class="o">+</span> <span class="s">&quot; = struct; &quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">ode_list</span><span class="p">]</span>
		<span class="n">mwrite</span><span class="p">(</span><span class="n">mfio</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>
		<span class="p">[</span><span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot;_out.&quot;</span> <span class="o">+</span> <span class="n">elem</span> <span class="o">+</span> <span class="s">&quot; = &quot;</span> <span class="o">+</span> <span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot;(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ode_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;,:); &quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">ode_list</span><span class="p">]</span>		
		<span class="c">#mwrite (mfio, &quot;\t&quot; + m_ode + &quot;_out.(&quot; + m_sens_names + &quot;(elem)) = &quot; + m_ode)</span>
		
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">for elem = 1:length(&quot;</span> <span class="o">+</span> <span class="n">m_sens_names</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span><span class="p">)</span>
		<span class="c">#mwrite (mfio, &quot;\tfor iter = 1:&quot; + str(len(self.index[&#39;ode&#39;][&#39;yes&#39;])))</span>
		<span class="p">[</span><span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">temp = &quot;</span> <span class="o">+</span> <span class="n">m_outsens</span> <span class="o">+</span> <span class="s">&quot;(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ode_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;,elem,:); &quot;</span> <span class="o">+</span> <span class="n">m_outsens</span> <span class="o">+</span> <span class="s">&quot;_out.&quot;</span> <span class="o">+</span> <span class="n">elem</span> <span class="o">+</span> <span class="s">&quot;.(&quot;</span> <span class="o">+</span> <span class="n">m_sens_names</span> <span class="o">+</span> <span class="s">&quot;{elem}) = temp(:);&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">ode_list</span><span class="p">]</span>
		<span class="c">#mwrite (mfio, &quot;\tend&quot;)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;end&quot;</span><span class="p">)</span>
		<span class="c">#type_only = [elem[:elem.find(&#39;(&#39;)] for elem in [elem[&#39;name&#39;] for elem in self.data_vec]]		</span>

		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;end </span><span class="si">% e</span><span class="s">nd of all session&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>





		
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">end </span><span class="si">% e</span><span class="s">nd of function&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>
		
		
		
		<span class="c"># Jacobian function</span>
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;numerical jacobian using the file numjac.m&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;function [J, flag, new_data] = &quot;</span> <span class="o">+</span> <span class="n">f_jacobian</span> <span class="o">+</span> \
						<span class="s">&quot;(&quot;</span> <span class="o">+</span> <span class="n">m_time</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot;,fy,&quot;</span> <span class="o">+</span> <span class="n">m_data</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;J = numjac(@(tt,yy)&quot;</span> <span class="o">+</span> <span class="n">f_ode</span> <span class="o">+</span> <span class="s">&quot;(tt,yy,&quot;</span> <span class="o">+</span> <span class="n">m_data</span> <span class="o">+</span> <span class="s">&quot;),&quot;</span> \
						<span class="o">+</span> <span class="n">m_time</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">f_ode</span> <span class="o">+</span> <span class="s">&quot;(&quot;</span> <span class="o">+</span> <span class="n">m_time</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
						<span class="o">+</span> <span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">m_data</span> <span class="o">+</span> <span class="s">&quot;),...</span><span class="se">\n</span><span class="s">&quot;</span> \
						<span class="o">+</span> <span class="s">&quot;</span><span class="se">\t\t\t</span><span class="s">ones(size(&quot;</span> <span class="o">+</span> <span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot;)) .* 1e-8,[],0);&quot;</span><span class="p">)</span>	
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;flag = 0;&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;new_data = [];&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;end</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>
		
		
		
		<span class="c">#mcomment (mfio, &quot;new ode function which shows no p_store independence&quot;,&quot;\n&quot;,&quot;\n\n&quot;)</span>
		<span class="c">#mwrite (mfio, &quot;function [] = &quot; + f_ode + \</span>
		<span class="c">#				&quot;(&quot; + m_time + &quot;,&quot; + m_ode + &quot;,&quot; + m_data + &quot;)&quot;)		</span>
		<span class="c">#mwrite (mfio, &quot;end\n\n&quot;)</span>

		
		<span class="c"># close file</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">close_file</span> <span class="p">(</span><span class="n">mfio</span><span class="p">)</span>
		
		
		
		
		
		</div>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	CREATE FSA sensitivity ODE-FILE MATLAB FILE FUNCTION</span>
<span class="sd">	the actual ODE system set up as a separate m file</span>
<span class="sd">	for passing into an ODE system</span>
<span class="sd">	&quot;&quot;&quot;</span>	
<div class="viewcode-block" id="MatlabParser.FSA_ode"><a class="viewcode-back" href="../../eqparse.html#eqparse.matlabparser.MatlabParser.FSA_ode">[docs]</a>	<span class="k">def</span> <span class="nf">FSA_ode</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Create FSA matlab ODE file (ode.m) to be used with :py:mod:`multi_runfile` and :py:mod:`multi_runfile_slider` modules&quot;&quot;&quot;</span>

						
		<span class="n">mfile</span> <span class="o">=</span> <span class="s">&quot;FSA_ode&quot;</span>
		<span class="n">mfio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="n">mfile</span>
		<span class="n">mcomment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_comment</span>
		<span class="n">mwrite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span>
		<span class="n">m_data</span> <span class="o">=</span> <span class="s">&quot;pdata&quot;</span>
		<span class="n">m_print</span> <span class="o">=</span> <span class="s">&quot;p_store&quot;</span>	<span class="c"># VC_NAME_PRINT</span>
		<span class="n">m_noprint</span> <span class="o">=</span> <span class="s">&quot;p&quot;</span>	<span class="c"># VEC_NAME</span>
		<span class="n">m_ode</span> <span class="o">=</span> <span class="s">&quot;dydt&quot;</span>	<span class="c"># ode var ODE_NAME</span>
		<span class="n">m_ode_rhs</span> <span class="o">=</span> <span class="s">&quot;y&quot;</span> <span class="c"># rhs dydt as y</span>
		<span class="n">mpersistent_out</span> <span class="o">=</span> <span class="s">&quot;out_&quot;</span> <span class="o">+</span> <span class="n">m_print</span>
		<span class="c">#mpersistent_temp = &quot;pers_&quot; + m_print</span>
		<span class="n">len_of_odes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">]))</span>
		
		<span class="c"># open file</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">open_file</span> <span class="p">(</span><span class="n">mfio</span><span class="p">)</span>

		<span class="c"># define header (function name etc)</span>
		<span class="c">#if yes_guess is None: new_arg = &quot;&quot;; temp = &quot;&quot;; jo = &quot;,&quot; + mpersistent_out</span>
		<span class="c">#else: new_arg = &quot;b&quot;; temp = &quot;,&quot; + new_arg; jo = &quot;&quot;</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;function [&quot;</span> <span class="o">+</span> <span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot;, flag, new_data] = &quot;</span> <span class="o">+</span> <span class="n">mfile</span> <span class="o">+</span> <span class="s">&quot;(t,&quot;</span> <span class="o">+</span> <span class="n">m_ode_rhs</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span> <span class="o">+</span> <span class="n">m_data</span> <span class="o">+</span> <span class="s">&quot;)</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>
										

		<span class="c">#mwrite (mfio, &quot;persistent &quot; + m_print + &quot; &quot; + m_noprint, &quot;\n\n&quot;, &quot;\n&quot;)		</span>
		
		<span class="c">#mwrite (mfio, m_print + &quot; = &quot; + m_data + &quot;.&quot; + m_print + &quot;;&quot;)</span>
		<span class="c">#mwrite (mfio, m_noprint + &quot; = &quot; + m_data + &quot;.&quot; + m_noprint + &quot;;&quot;)</span>
		
		<span class="c">#if yes_guess is None:								</span>
		<span class="c">#mwrite (mfio, [&quot;persistent &quot; + mpersistent_temp + &quot; counter&quot;,</span>
							<span class="c">#&quot;if isempty(&quot; + mpersistent_temp + &quot;)&quot;, </span>
							<span class="c">#&quot;\t&quot; + mpersistent_temp + &quot; = zeros(200,size(&quot; + m_print + &quot;,2));\n\tcounter = 1;&quot;,</span>
							<span class="c">#&quot;end&quot;], &quot;\n&quot; )</span>
		<span class="c">#mwrite (mfio, [&quot;if mod(counter-1,200) == 0&quot;,</span>
							<span class="c">#&quot;\t&quot; + mpersistent_temp + &quot; = [&quot; + mpersistent_temp + &quot;; zeros(200,size(&quot; + m_print + &quot;,2))];&quot;,</span>
							<span class="c">#&quot;end&quot;], &quot;\n&quot;)		</span>
		
		<span class="c">#mcomment (mfio, &quot;solve the ode step...&quot;)</span>
		
		<span class="c">#mwrite (mfio, [m_ode + &quot; = zeros(&quot; + str(len_of_odes) + &quot;,1);&quot;])</span>
		<span class="c">#mwrite (mfio, &quot;if (nargout == 1)&quot;)</span>

		<span class="c">#if yes_guess is None:</span>
		<span class="c"># if guess</span>
		<span class="n">oderhs_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorise_name</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;var&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;print&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">]),</span> <span class="s">&quot;p_store&quot;</span><span class="p">)</span>
		<span class="n">oderhs_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorise_name</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;var&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;print&#39;</span><span class="p">][</span><span class="s">&#39;no&#39;</span><span class="p">]),</span> <span class="s">&quot;p&quot;</span><span class="p">,</span> <span class="n">oderhs_names</span><span class="p">)</span>
		<span class="n">oderhs_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorise_name</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">],</span> <span class="s">&quot;y&quot;</span><span class="p">,</span> <span class="n">oderhs_names</span><span class="p">)</span>
		<span class="n">m_rhs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_and_replace</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_list</span> <span class="p">(</span><span class="s">&quot;rhs&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="n">oderhs_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>

			
		<span class="c">#mwrite (mfio, m_print + &quot;(end) = t;&quot;)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot; = zeros(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">]))</span> <span class="o">+</span> <span class="s">&quot;,1);&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;flag = 0;&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;new_data = [];&quot;</span><span class="p">)</span>		
		
		<span class="c">#mwrite (mfio, &quot;\nif nargout &lt; 4&quot;)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot; = &quot;</span> <span class="o">+</span> <span class="n">m_data</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span> <span class="o">+</span> <span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot;;&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">m_noprint</span> <span class="o">+</span> <span class="s">&quot; = &quot;</span> <span class="o">+</span> <span class="n">m_data</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span> <span class="o">+</span> <span class="n">m_noprint</span> <span class="o">+</span> <span class="s">&quot;;&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>			
		<span class="n">setODEFormatAs</span> <span class="o">=</span> <span class="mi">2</span>
		<span class="c"># 1: old format, based on function</span>
		<span class="c"># 2: new format, ordering dependent</span>
		<span class="k">if</span> <span class="n">setODEFormatAs</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
		<span class="c"># ORIGINAL ODE/PARAM UPDATE</span>
			<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;function&#39;</span><span class="p">])):</span>
				<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;function&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">],</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">pattern_write</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="n">m_rhs</span><span class="p">,</span> <span class="s">&quot;comment&quot;</span><span class="p">],</span> <span class="p">[</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot; = &quot;</span><span class="p">,</span> <span class="s">&quot;; %&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_vec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;function&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;index&#39;</span><span class="p">])</span>
		<span class="k">elif</span> <span class="n">setODEFormatAs</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
			<span class="n">index_nonode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_dependancy_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;no&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;rhs&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">]),</span><span class="s">&#39;rhs&#39;</span><span class="p">)</span>
			<span class="c">#for indexer in index_nonode:</span>
			<span class="c">#	print self.data[indexer][&#39;rhs&#39;]</span>
			<span class="c"># print all function related dependencies in front of order</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">pattern_write</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="n">m_rhs</span><span class="p">,</span> <span class="s">&quot;comment&quot;</span><span class="p">],</span> <span class="p">[</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot; = &quot;</span><span class="p">,</span> <span class="s">&quot;; %&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_vec</span><span class="p">,</span> <span class="n">index_nonode</span><span class="p">)</span>
			<span class="c"># print all ODE related dependencies out to file in last order</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">pattern_write</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="n">m_rhs</span><span class="p">,</span> <span class="s">&quot;comment&quot;</span><span class="p">],</span> <span class="p">[</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot; = &quot;</span><span class="p">,</span> <span class="s">&quot;; %&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_vec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">])</span>			
			<span class="c">#new_dependancy_index	</span>
			<span class="c">#mIndex_nonode = self.order_index (self.new_index(self.index[&#39;ode&#39;][&#39;no&#39;],self.index[&#39;rhs&#39;][&#39;yes&#39;]))</span>
			<span class="c">#mIndex_ode = self.order_index (self.index[&#39;ode&#39;][&#39;yes&#39;])</span>
			<span class="c">#self.pattern_write (mfio, [&quot;name&quot;, m_rhs, self.names, &quot;comment&quot;], [ &quot; &quot;, &quot; = &quot;, &quot;; % {&quot;, &quot;} &quot;, &quot; &quot;], self.data_vec, mIndex_nonode)</span>
			<span class="c">#self.pattern_write (mfio, [&quot;name&quot;, m_rhs, self.names, &quot;comment&quot;], [ &quot; &quot;, &quot; = &quot;, &quot;; % {&quot;, &quot;} &quot;, &quot; &quot;], self.data_vec, mIndex_ode)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">None</span>		
		
		<span class="c">#mwrite (mfio, &quot;else&quot;)</span>
		<span class="c">#mwrite (mfio, &quot;\ts_&quot; + m_print + &quot; = &quot; + m_print + &quot;;&quot;)</span>
		<span class="c">#mwrite (mfio, &quot;\ts_&quot; + m_noprint + &quot; = &quot; + m_noprint + &quot;;&quot;)</span>
		<span class="c">#mwrite (mfio, &quot;end&quot;)</span>
			

			
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">end </span><span class="si">% e</span><span class="s">nd ode function&quot;</span><span class="p">)</span>		
				
		<span class="bp">self</span><span class="o">.</span><span class="n">close_file</span> <span class="p">(</span><span class="n">mfio</span><span class="p">)</span>





</div>
	<span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>	
	<span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>	
	<span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>	
	<span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
	<span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>	
	<span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>	
	<span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>	
	<span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>	
	<span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>	
	<span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>	
	<span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>	
	<span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>			
	<span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>	
	<span class="sd">&quot;&quot;&quot;			</span>
<span class="sd">	CREATE SLIDER_RUN_FILE MATLAB FILE FUNCTION *** WITH INSET ODE ***</span>
<span class="sd">	contains the actual set-up and organisation of cell system</span>
<span class="sd">	in a structured order, is also main file</span>
<span class="sd">	&quot;&quot;&quot;</span>
<div class="viewcode-block" id="MatlabParser.inset_runfile_slider"><a class="viewcode-back" href="../../eqparse.html#eqparse.matlabparser.MatlabParser.inset_runfile_slider">[docs]</a>	<span class="k">def</span> <span class="nf">inset_runfile_slider</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newSubDirectory</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">file_ext</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">no_guess</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">yes_guess</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>

		<span class="c">#mfile = &quot;run&quot; + file_ext</span>
		<span class="n">mfile</span> <span class="o">=</span>  <span class="s">&quot;run_slider_nested&quot;</span> <span class="o">+</span> <span class="n">file_ext</span>
		<span class="n">mfio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="n">newSubDirectory</span> <span class="o">+</span> <span class="n">mfile</span>
		<span class="n">mcomment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_comment</span>
		<span class="n">mwrite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span>
		<span class="n">m_print</span> <span class="o">=</span> <span class="s">&quot;p_store&quot;</span>	<span class="c"># VC_NAME_PRINT</span>
		<span class="n">m_noprint</span> <span class="o">=</span> <span class="s">&quot;p&quot;</span>	<span class="c"># VEC_NAME</span>
		<span class="n">m_ode</span> <span class="o">=</span> <span class="s">&quot;dydt&quot;</span>	<span class="c"># ode var ODE_NAME</span>
		<span class="n">m_out</span> <span class="o">=</span> <span class="s">&quot;out&quot;</span>
		<span class="n">m_otime</span><span class="o">=</span> <span class="s">&#39;out_time&#39;</span>
		<span class="n">t_end</span> <span class="o">=</span> <span class="s">&quot;t_end&quot;</span>
		<span class="n">set_p</span> <span class="o">=</span> <span class="s">&quot;initial&quot;</span>
		<span class="n">ode_method</span> <span class="o">=</span> <span class="s">&quot;ode15s&quot;</span>
		<span class="n">m_ode_fname</span> <span class="o">=</span> <span class="s">&quot;ode&quot;</span>
		<span class="n">m_add_events</span> <span class="o">=</span> <span class="s">&quot;passEvents&quot;</span>
		<span class="n">m_struct</span> <span class="o">=</span> <span class="s">&quot;options&quot;</span>
		<span class="n">m_print_out</span> <span class="o">=</span> <span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot;_out&quot;</span>

		<span class="c"># open file</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">open_file</span> <span class="p">(</span><span class="n">mfio</span><span class="p">)</span>
		
		<span class="c"># define header</span>
		<span class="k">if</span> <span class="n">yes_guess</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">mp</span> <span class="o">=</span> <span class="n">m_out</span>
		<span class="k">else</span><span class="p">:</span> <span class="n">mp</span> <span class="o">=</span> <span class="s">&quot;b_out&quot;</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;function [&quot;</span> <span class="o">+</span> <span class="n">mp</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">set_p</span> <span class="o">+</span> <span class="s">&quot;] = &quot;</span> <span class="o">+</span> <span class="n">mfile</span> <span class="o">+</span> <span class="s">&quot; (&quot;</span> \
							<span class="o">+</span> <span class="n">set_p</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">m_add_events</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">m_struct</span> \
							<span class="o">+</span> <span class="s">&quot;)</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>
		<span class="c">#					+ set_p + &quot;, &quot; + t_end + &quot;, b_in)&quot;, &quot;\n\n&quot;)	</span>
		
		<span class="c">#</span>
		<span class="c"># persistent variables</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;persistent name_only type_only iter_only</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
						<span class="s">&quot;counter = 1;&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">])</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="n">m_print_out</span> <span class="o">+</span> <span class="s">&quot; = 0;&quot;</span><span class="p">)</span>
		
		
		
		<span class="c">#---------------------# DEFINE NESTED ODE</span>
						
		<span class="n">m_ode_nested</span> <span class="o">=</span> <span class="s">&quot;dydt&quot;</span>	<span class="c"># ode var ODE_NAME</span>
		<span class="n">m_ode_rhs</span> <span class="o">=</span> <span class="s">&quot;y&quot;</span> <span class="c"># rhs dydt as y</span>
		<span class="c">#mpersistent_out = &quot;out_&quot; + m_print</span>
		<span class="n">mpersistent_temp</span> <span class="o">=</span> <span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot;_out&quot;</span>
		<span class="n">len_of_odes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">]))</span>
		
		
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;function to solve the ode step...&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;function &quot;</span> <span class="o">+</span> <span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot; = odesystem (t,y)&quot;</span><span class="p">)</span>	
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;if mod(counter-1,200) == 0&quot;</span><span class="p">,</span>
			<span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">mpersistent_temp</span> <span class="o">+</span> <span class="s">&quot; = [&quot;</span> <span class="o">+</span> <span class="n">mpersistent_temp</span> <span class="o">+</span> <span class="s">&quot;; zeros(200,size(&quot;</span> <span class="o">+</span> <span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot;,2))];&quot;</span><span class="p">,</span><span class="s">&quot;end&quot;</span><span class="p">],</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="n">m_ode_nested</span> <span class="o">+</span> <span class="s">&quot; = zeros(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">len_of_odes</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;,1);&quot;</span><span class="p">])</span>
		<span class="c">#mwrite (mfio, &quot;if (nargout == 1)&quot;)</span>

		<span class="n">oderhs_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorise_name</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;var&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;print&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">]),</span> <span class="s">&quot;p_store&quot;</span><span class="p">)</span>
		<span class="n">oderhs_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorise_name</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;var&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;print&#39;</span><span class="p">][</span><span class="s">&#39;no&#39;</span><span class="p">]),</span> <span class="s">&quot;p&quot;</span><span class="p">,</span> <span class="n">oderhs_names</span><span class="p">)</span>
		<span class="n">oderhs_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorise_name</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">],</span> <span class="s">&quot;y&quot;</span><span class="p">,</span> <span class="n">oderhs_names</span><span class="p">)</span>
		<span class="n">m_rhs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_and_replace</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_list</span> <span class="p">(</span><span class="s">&quot;rhs&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="n">oderhs_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>

			
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot;(end) = t;&quot;</span><span class="p">)</span>
		<span class="n">setODEFormatAs</span> <span class="o">=</span> <span class="mi">2</span>
		<span class="c"># 1: old format, based on function</span>
		<span class="c"># 2: new format, ordering dependent</span>
		<span class="k">if</span> <span class="n">setODEFormatAs</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
		<span class="c"># ORIGINAL ODE/PARAM UPDATE</span>
			<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;function&#39;</span><span class="p">])):</span>
				<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;function&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">],</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">pattern_write</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="n">m_rhs</span><span class="p">,</span> <span class="s">&quot;comment&quot;</span><span class="p">],</span> <span class="p">[</span> <span class="s">&quot; &quot;</span><span class="p">,</span> <span class="s">&quot; = &quot;</span><span class="p">,</span> <span class="s">&quot;; %&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_vec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;function&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;index&#39;</span><span class="p">])</span>
		<span class="k">elif</span> <span class="n">setODEFormatAs</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
			<span class="n">index_nonode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_dependancy_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;no&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;rhs&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">]),</span><span class="s">&#39;rhs&#39;</span><span class="p">)</span>
			<span class="c">#for indexer in index_nonode:</span>
			<span class="c">#	print self.data[indexer][&#39;rhs&#39;]</span>
			<span class="c"># print all function related dependencies in front of order</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">pattern_write</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="n">m_rhs</span><span class="p">,</span> <span class="s">&quot;comment&quot;</span><span class="p">],</span> <span class="p">[</span> <span class="s">&quot; &quot;</span><span class="p">,</span> <span class="s">&quot; = &quot;</span><span class="p">,</span> <span class="s">&quot;; %&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_vec</span><span class="p">,</span> <span class="n">index_nonode</span><span class="p">)</span>
			<span class="c"># print all ODE related dependencies out to file in last order</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">pattern_write</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="n">m_rhs</span><span class="p">,</span> <span class="s">&quot;comment&quot;</span><span class="p">],</span> <span class="p">[</span> <span class="s">&quot; &quot;</span><span class="p">,</span> <span class="s">&quot; = &quot;</span><span class="p">,</span> <span class="s">&quot;; %&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_vec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">])</span>			

		<span class="k">else</span><span class="p">:</span>
			<span class="bp">None</span>		
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="n">m_print_out</span> <span class="o">+</span> <span class="s">&quot;(counter,:)=&quot;</span> <span class="o">+</span> <span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot;;&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;counter = counter + 1;&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;end </span><span class="se">\n</span><span class="si">%--- e</span><span class="s">nd ode function&quot;</span><span class="p">)</span>		
				
		<span class="c">#---------------------#  DEFINE NESTED ODE</span>


		
		<span class="c">#</span>
		<span class="c"># NOTE: this is the extra commands for slider version of run</span>
		<span class="c">#</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span><span class="s">&quot;if nargout==2&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
				
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">out = {};&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>		
		<span class="c"># initial params : get initial params only (for slider)</span>
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">initialize the original parameter output&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">set_p</span> <span class="o">+</span> <span class="s">&#39; = initialise_data;&#39;</span><span class="p">)</span>

		<span class="c">#if no_guess	is None: 	mIndex = self.order_index(self.index[&#39;userdef&#39;][&#39;yes&#39;]) #self.index[&#39;order&#39;][&#39;init-value&#39;];</span>
		<span class="c">#else:					mIndex = self.order_index (no_guess)</span>
		
		<span class="n">mIndex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;userdef&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">])</span>
		<span class="n">mIndex_odeyes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_index</span><span class="p">(</span><span class="n">mIndex</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;yes&#39;</span><span class="p">])</span>
		<span class="n">mIndex_odeno</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_index</span><span class="p">(</span><span class="n">mIndex</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">&#39;ode&#39;</span><span class="p">][</span><span class="s">&#39;no&#39;</span><span class="p">])</span>
		<span class="c">#for elem in yes_guess:</span>
		<span class="c">#	mName[elem] = &quot;b(&quot; + str(cntr) + &quot;)&quot;</span>
		<span class="c">#	cntr = cntr + 1</span>
		
		<span class="c">##p_list = self.get_list (&#39;name&#39;, self.data, set_p + &quot;.&quot;,&quot;&quot;)</span>
		<span class="n">p_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list</span> <span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">mIndex_odeyes</span><span class="p">:</span>
			<span class="n">p_list</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="n">set_p</span> <span class="o">+</span> <span class="n">p_list</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span>
		<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">mIndex_odeno</span><span class="p">:</span>
			<span class="n">p_list</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="n">set_p</span> <span class="o">+</span> <span class="n">p_list</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span>
		
		<span class="n">p_rhs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_and_replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_list</span> <span class="p">(</span><span class="s">&#39;init-value&#39;</span><span class="p">),</span> <span class="n">p_list</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="p">)</span>

		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;else&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>

		<span class="c"># if parameterizing it, create initial data from external function</span>
		<span class="c"># and define parameter initial values also</span>
		<span class="k">if</span> <span class="n">no_guess</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
			<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;Define sample data to fit model here ()&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;[tdata,ydata] = create_ic (t_end);&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">if nargin&lt;3&quot;</span><span class="p">)</span>
			<span class="n">mName</span> <span class="o">=</span> <span class="p">[</span><span class="n">elem</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">];</span> <span class="n">cntr</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">yes_guess</span><span class="p">:</span>
				<span class="n">mName</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;b(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cntr</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span>
				<span class="n">cntr</span> <span class="o">=</span> <span class="n">cntr</span> <span class="o">+</span> <span class="mi">1</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">pattern_write</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="n">mName</span><span class="p">,</span> <span class="s">&quot;init-value&quot;</span><span class="p">,</span> <span class="s">&quot;comment&quot;</span><span class="p">],</span> <span class="p">[</span> <span class="s">&quot; &quot;</span><span class="p">,</span> <span class="s">&quot; = &quot;</span><span class="p">,</span> <span class="s">&quot;; </span><span class="se">\t</span><span class="s">% &quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_vec</span><span class="p">,</span> <span class="n">yes_guess</span><span class="p">)</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;else</span><span class="se">\n\t</span><span class="s">b=b_in</span><span class="se">\n</span><span class="s">end&quot;</span><span class="p">)</span>

									
		<span class="c"># ..user defined args</span>
		

		<span class="c"># initialise data for system run</span>
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;initialise the data prior to ode solver run&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span><span class="s">&quot;[&quot;</span> <span class="o">+</span> <span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">m_noprint</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot;] = initialise_data(&quot;</span> <span class="o">+</span> <span class="n">set_p</span> <span class="o">+</span> <span class="s">&quot;);</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>		
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="n">m_print_out</span> <span class="o">+</span> <span class="s">&quot;=&quot;</span> <span class="o">+</span> <span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot;;&quot;</span><span class="p">)</span>

		
		
		<span class="n">iter_only</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;\((.*)\)&#39;</span><span class="p">,</span> <span class="n">elem</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_vec</span><span class="p">]</span>
		<span class="n">type_only</span> <span class="o">=</span> <span class="p">[</span><span class="n">elem</span><span class="p">[:</span><span class="n">elem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;(&#39;</span><span class="p">)]</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="p">[</span><span class="n">elem</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_vec</span><span class="p">]]</span>		
		<span class="c"># print the names</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">if isempty(name_only)</span><span class="se">\n\t</span><span class="s">name_only = {&quot;</span> <span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iter_only</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;&#39;&quot;</span> <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;&#39;};</span><span class="se">\n</span><span class="s">end&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>
		<span class="c"># print the types</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">if isempty(type_only)</span><span class="se">\n\t</span><span class="s">type_only = {&quot;</span> <span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iter_only</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="n">type_only</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;&#39;&quot;</span>  <span class="o">+</span> <span class="s">&quot;,&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="n">type_only</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;&#39;};</span><span class="se">\n</span><span class="s">end&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>
		<span class="c"># print the iters</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">if isempty(iter_only)</span><span class="se">\n\t</span><span class="s">iter_only = [&quot;</span> <span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iter_only</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="n">iter_only</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="n">iter_only</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;];</span><span class="se">\n</span><span class="s">end&quot;</span><span class="p">)</span>
				<span class="c"># myString[myString.find(&quot;!&quot;)+1:myString.find(&quot;@&quot;)]</span>
					
<span class="c"># s[len(start):-len(end)]</span>

		<span class="c"># predefine time, if no input given</span>
		<span class="c"># mwrite (mfio, [&quot;if nargin&lt;2&quot;, &quot;\t&quot; + t_end + &quot; = &quot; + set_p + &quot;.&quot; + t_end + &quot;;&quot;, &quot;end\n&quot;])		</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="p">[</span><span class="n">t_end</span> <span class="o">+</span> <span class="s">&quot; = &quot;</span> <span class="o">+</span> <span class="n">set_p</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span> <span class="o">+</span> <span class="n">t_end</span> <span class="o">+</span> <span class="s">&quot;;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">])</span>		
		<span class="c"># add events (m_add_events is passEvents)</span>
		<span class="n">m_size_add_events</span> <span class="o">=</span> <span class="s">&quot;size_&quot;</span> <span class="o">+</span> <span class="n">m_add_events</span>
		<span class="n">m_add_events_vec</span> <span class="o">=</span> <span class="s">&quot;time_vec&quot;</span>
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;set up static events module if not defined&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;if nargin==1</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span> \
				<span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">m_add_events</span> <span class="o">+</span> <span class="s">&quot;.time = []; % time point step all &lt; t_end [vector]</span><span class="se">\n</span><span class="s">&quot;</span> \
				<span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">m_add_events</span> <span class="o">+</span> <span class="s">&quot;.change = {[]}; </span><span class="si">% c</span><span class="s">hanges to parameter values [vector]</span><span class="se">\n</span><span class="s">&quot;</span> \
				<span class="s">&quot;elseif nargin==2</span><span class="se">\n</span><span class="s">&quot;</span> \
				<span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">m_add_events</span> <span class="o">+</span> <span class="s">&quot;.change = {[],&quot;</span> <span class="o">+</span> <span class="n">m_add_events</span> <span class="o">+</span> <span class="s">&quot;.change{:}};</span><span class="se">\n</span><span class="s">&quot;</span> \
				<span class="s">&quot;end</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="n">m_add_events_vec</span> <span class="o">+</span> <span class="s">&quot; = [0,&quot;</span> <span class="o">+</span> <span class="n">m_add_events</span> <span class="o">+</span> <span class="s">&quot;.time,t_end];&quot;</span><span class="p">)</span>
		
		<span class="c"># start ode</span>
		<span class="k">if</span> <span class="n">no_guess</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
			<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;solve ode set through event set&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;t=[];&quot;</span><span class="p">)</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;% &quot;</span> <span class="o">+</span> <span class="n">m_print_out</span> <span class="o">+</span> <span class="s">&quot;=&quot;</span> <span class="o">+</span> <span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot;;&quot;</span><span class="p">)</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;options_ode = odeset(&#39;InitialStep&#39;,0.02,&#39;MaxStep&#39;,250, &#39;RelTol&#39;, 1e-9, &#39;AbsTol&#39;, 1e-9);&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;for i=1:numel(&quot;</span> <span class="o">+</span> <span class="n">m_add_events_vec</span> <span class="o">+</span> <span class="s">&quot;)-1</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>			
			<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;change parameter&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n\t</span><span class="s">&quot;</span><span class="p">)</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">CHANGICALS = &quot;</span> <span class="o">+</span> <span class="n">m_add_events</span> <span class="o">+</span> <span class="s">&quot;.change{i};</span><span class="se">\n</span><span class="s">&quot;</span> \
					<span class="s">&quot;    for j=1:numel(CHANGICALS)</span><span class="se">\n</span><span class="s">&quot;</span> \
					<span class="s">&quot;        niter = strmatch(CHANGICALS{j}{1},name_only,&#39;exact&#39;);</span><span class="se">\n</span><span class="s">&quot;</span> \
					<span class="s">&quot;        switch type_only{niter}</span><span class="se">\n</span><span class="s">&quot;</span> \
					<span class="s">&quot;            case &#39;&quot;</span> <span class="o">+</span> <span class="n">m_noprint</span> <span class="o">+</span> <span class="s">&quot;&#39;</span><span class="se">\n</span><span class="s">&quot;</span> \
					<span class="s">&quot;                &quot;</span> <span class="o">+</span> <span class="n">m_noprint</span> <span class="o">+</span> <span class="s">&quot;(iter_only(niter)) = CHANGICALS{j}{2};</span><span class="se">\n</span><span class="s">&quot;</span> 
					<span class="s">&quot;            case &#39;&quot;</span> <span class="o">+</span> <span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot;&#39;</span><span class="se">\n</span><span class="s">&quot;</span> \
					<span class="s">&quot;                &quot;</span> <span class="o">+</span> <span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot;(end,iter_only(niter)) = CHANGICALS{j}{2};</span><span class="se">\n</span><span class="s">&quot;</span> 
					<span class="s">&quot;            case &#39;&quot;</span> <span class="o">+</span> <span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot;&#39;</span><span class="se">\n</span><span class="s">&quot;</span> \
					<span class="s">&quot;                &quot;</span> <span class="o">+</span> <span class="n">m_print</span> <span class="o">+</span> <span class="s">&quot;(end,iter_only(niter)) = CHANGICALS{j}{2};</span><span class="se">\n</span><span class="s">&quot;</span> 
					<span class="s">&quot;        end</span><span class="se">\n</span><span class="s">&quot;</span> \
					<span class="s">&quot;    end</span><span class="se">\n</span><span class="s">&quot;</span> \
					<span class="p">,</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>

			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">[t_temp,&quot;</span> <span class="o">+</span> <span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot;_temp] = &quot;</span> <span class="o">+</span> <span class="n">ode_method</span> <span class="o">+</span> <span class="s">&quot;(@&quot;</span> <span class="o">+</span> <span class="n">m_ode_fname</span> <span class="o">+</span> <span class="s">&quot;system,...</span><span class="se">\n\t\t</span><span class="s">&quot;</span>
						<span class="o">+</span> <span class="n">m_add_events_vec</span> <span class="o">+</span> <span class="s">&quot;(i:i+1)&#39;.*1000,&quot;</span> <span class="o">+</span> <span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot;(end,:),options_ode);&quot;</span><span class="p">)</span>
			<span class="c">#mwrite (mfio, &quot;%\t[~,&quot; + m_print + &quot;] = &quot; + m_ode_fname + &quot;([],[],[],[]);&quot;)</span>
			<span class="c">#mwrite (mfio, &quot;%\t[~, index_max_t_] = max(&quot; + m_print + &quot;(:,end));&quot;)</span>
			<span class="c">#mwrite (mfio, &quot;%\t&quot; + m_print_out + &quot; = [&quot; + m_print_out + &quot;;&quot; + m_print + &quot;(1:index_max_t_,:)]; %#ok&lt;AGROW&gt;&quot;)</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot; = [&quot;</span> <span class="o">+</span> <span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot;;&quot;</span> <span class="o">+</span> <span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot;_temp(1:end-1,:)]; </span><span class="si">%#o</span><span class="s">k&lt;AGROW&gt;&quot;</span><span class="p">)</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">t = [t(1:end-1) t_temp&#39;];&quot;</span><span class="p">)</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;end&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>

			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;[~,index_max_t] = max(&quot;</span> <span class="o">+</span> <span class="n">m_print_out</span> <span class="o">+</span> <span class="s">&quot;(:,end));&quot;</span><span class="p">)</span>			
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="n">m_out</span> <span class="o">+</span> <span class="s">&quot;= return_organised(&quot;</span> <span class="o">+</span> <span class="n">m_ode</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">m_print_out</span> <span class="o">+</span> <span class="s">&quot;(1:index_max_t,:));&quot;</span><span class="p">)</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="n">m_out</span> <span class="o">+</span> <span class="s">&quot;.var = &quot;</span> <span class="o">+</span> <span class="n">m_print_out</span> <span class="o">+</span> <span class="s">&quot;(1:index_max_t,end)./1000;&quot;</span><span class="p">)</span>
			<span class="n">mwrite</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="n">m_out</span> <span class="o">+</span> <span class="s">&quot;.ode = t./1000; </span><span class="si">% c</span><span class="s">onverted to seconds&quot;</span><span class="p">)</span> <span class="c">#,	#struct;&quot;,</span>

		
		
		
		
		<span class="n">mwrite</span><span class="p">(</span><span class="n">mfio</span><span class="p">,</span><span class="s">&#39;end&#39;</span><span class="p">)</span>
		
		
		<span class="n">mcomment</span> <span class="p">(</span><span class="n">mfio</span><span class="p">,</span> <span class="s">&quot;--- end of all function run_slider_nested&quot;</span><span class="p">)</span>
		<span class="n">mwrite</span><span class="p">(</span><span class="n">mfio</span><span class="p">,</span><span class="s">&#39;end&#39;</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">close_file</span> <span class="p">(</span><span class="n">mfio</span><span class="p">)</span>
		
		<span class="c">#self.supp_input_ic()</span>
		<span class="c">#self.vectorised_to_readable()	# return file to simplify for plotting</span>
		<span class="c">#self.supp_initialise_data()</span>


<span class="c">##### MATLAB - &#39;ALL TOGETHER&#39; NESTED FUNCTION RUN_SLIDER</span>
<span class="c"># this causes simulations to run faster as functions are nested and available locally</span>

	<span class="c">#def inset_runfile_slider (self</span>
</pre></div></div></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">src  documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Author.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>